{{ define "head" }}
<style>
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
        background: linear-gradient(135deg, #EFF6FF 0%, #E0F2FE 50%, #D1FAE5 100%);
        min-height: 100vh;
    }

    .compare-container {
        max-width: 1400px;
        margin: 60px auto;
        padding: 0 20px;
    }

    .compare-header {
        text-align: center;
        margin-bottom: 60px;
    }

    .compare-title {
        font-size: 3rem;
        background: linear-gradient(135deg, #0EA5E9, #14B8A6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 900;
        margin-bottom: 16px;
    }

    .compare-subtitle {
        font-size: 1.2rem;
        color: #4B5563;
        margin-bottom: 32px;
    }

    /* ì„ íƒ UI */
    .selection-section {
        background: white;
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        margin-bottom: 40px;
    }

    .selection-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 32px;
    }

    .selector-box {
        border: 3px dashed #CBD5E1;
        border-radius: 20px;
        padding: 32px;
        text-align: center;
        transition: all 0.3s ease;
    }

    .selector-box.selected {
        border-color: #0EA5E9;
        background: rgba(14, 165, 233, 0.05);
        border-style: solid;
    }

    .selector-label {
        font-size: 1.4rem;
        font-weight: 800;
        color: #2d3748;
        margin-bottom: 20px;
    }

    .result-select {
        width: 100%;
        padding: 16px;
        border: 2px solid #E2E8F0;
        border-radius: 12px;
        font-size: 1.1rem;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .result-select:focus {
        outline: none;
        border-color: #0EA5E9;
        box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
    }

    .selected-preview {
        margin-top: 20px;
        padding: 20px;
        background: rgba(14, 165, 233, 0.1);
        border-radius: 12px;
        display: none;
    }

    .selected-preview.show {
        display: block;
    }

    .compare-btn {
        display: block;
        width: 100%;
        max-width: 400px;
        margin: 32px auto 0;
        padding: 20px 48px;
        background: linear-gradient(135deg, #0EA5E9, #14B8A6);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 1.3rem;
        font-weight: 800;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 24px rgba(14, 165, 233, 0.4);
    }

    .compare-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(14, 165, 233, 0.6);
    }

    .compare-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* ë¹„êµ ê²°ê³¼ */
    .comparison-section {
        display: none;
    }

    .comparison-section.show {
        display: block;
    }

    .compatibility-score {
        text-align: center;
        background: white;
        border-radius: 24px;
        padding: 50px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        margin-bottom: 40px;
    }

    .compat-icon {
        font-size: 6rem;
        margin-bottom: 20px;
        animation: heartbeat 1.5s ease-in-out infinite;
    }

    @keyframes heartbeat {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .compat-score-number {
        font-size: 5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #EC4899, #F43F5E);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 20px 0;
    }

    .compat-grade {
        font-size: 2rem;
        color: #EC4899;
        font-weight: 800;
        margin-bottom: 16px;
    }

    .compat-description {
        font-size: 1.2rem;
        color: #6B7280;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.8;
    }

    .results-comparison {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 32px;
        margin-bottom: 40px;
    }

    .result-column {
        background: white;
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
    }

    .result-column-header {
        text-align: center;
        margin-bottom: 32px;
        padding-bottom: 24px;
        border-bottom: 2px solid #E2E8F0;
    }

    .result-column-title {
        font-size: 1.8rem;
        font-weight: 800;
        color: #2d3748;
        margin-bottom: 12px;
    }

    .result-column-subtitle {
        font-size: 1.1rem;
        color: #6B7280;
    }

    .result-type-badge {
        display: inline-block;
        padding: 12px 24px;
        background: linear-gradient(135deg, #0EA5E9, #14B8A6);
        color: white;
        border-radius: 50px;
        font-size: 1.2rem;
        font-weight: 800;
        margin: 16px 0;
    }

    .same-result {
        background: white;
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        margin-bottom: 32px;
        border: 3px solid #10B981;
    }

    .same-result-title {
        font-size: 2rem;
        color: #10B981;
        font-weight: 800;
        text-align: center;
        margin-bottom: 24px;
    }

    .same-icon {
        font-size: 4rem;
        text-align: center;
        margin-bottom: 16px;
    }

    .analysis-box {
        background: rgba(14, 165, 233, 0.05);
        border-radius: 16px;
        padding: 32px;
        margin: 24px 0;
    }

    .analysis-title {
        font-size: 1.5rem;
        font-weight: 800;
        color: #2d3748;
        margin-bottom: 16px;
    }

    .analysis-list {
        list-style: none;
        padding: 0;
    }

    .analysis-list li {
        padding: 12px 0;
        padding-left: 32px;
        position: relative;
        color: #4a5568;
        line-height: 1.8;
    }

    .analysis-list li::before {
        content: 'âœ“';
        position: absolute;
        left: 0;
        color: #0EA5E9;
        font-weight: 800;
        font-size: 1.2rem;
    }

    .share-section-compare {
        text-align: center;
        background: white;
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
    }

    @media (max-width: 1024px) {
        .selection-grid,
        .results-comparison {
            grid-template-columns: 1fr;
        }

        .compare-title {
            font-size: 2rem;
        }

        .compat-score-number {
            font-size: 4rem;
        }
    }
</style>
{{ end }}

{{ define "main" }}
<div class="compare-container">
    <div class="compare-header">
        <h1 class="compare-title">ğŸ¤ ì¹œêµ¬ì™€ ê²°ê³¼ ë¹„êµí•˜ê¸°</h1>
        <p class="compare-subtitle">ë‘ ì‚¬ëŒì˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë¹„êµí•´ë³´ì„¸ìš”!</p>
    </div>

    <!-- ì„ íƒ ì„¹ì…˜ -->
    <div id="selectionSection" class="selection-section">
        <div class="selection-grid">
            <div class="selector-box" id="selector1">
                <div class="selector-label">ğŸ‘¤ ì²« ë²ˆì§¸ ê²°ê³¼ ì„ íƒ</div>
                <select class="result-select" id="result1Select">
                    <option value="">ê²°ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
                <div class="selected-preview" id="preview1"></div>
            </div>

            <div class="selector-box" id="selector2">
                <div class="selector-label">ğŸ‘¥ ë‘ ë²ˆì§¸ ê²°ê³¼ ì„ íƒ</div>
                <select class="result-select" id="result2Select">
                    <option value="">ê²°ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
                <div class="selected-preview" id="preview2"></div>
            </div>
        </div>

        <button class="compare-btn" id="compareBtn" disabled>
            ë¹„êµí•˜ê¸° â†’
        </button>
    </div>

    <!-- ë¹„êµ ê²°ê³¼ ì„¹ì…˜ -->
    <div id="comparisonSection" class="comparison-section">
        <!-- ê¶í•©ë„ ì ìˆ˜ -->
        <div class="compatibility-score">
            <div class="compat-icon">ğŸ‰</div>
            <div class="compat-score-number" id="compatScore">0</div>
            <div class="compat-grade" id="compatGrade"></div>
            <p class="compat-description" id="compatDescription"></p>
        </div>

        <!-- ê°™ì€ ê²°ê³¼ì¼ ë•Œ -->
        <div id="sameResultBox" class="same-result" style="display: none;">
            <div class="same-icon">ğŸŠ</div>
            <h3 class="same-result-title">ì™„ì „íˆ ê°™ì€ ê²°ê³¼ì˜ˆìš”!</h3>
            <p style="text-align: center; font-size: 1.2rem; color: #6B7280;">
                ë‘ ë¶„ì€ ê°™ì€ ì„±í–¥ì„ ê°€ì§€ê³  ê³„ì‹œë„¤ìš”. ì„œë¡œë¥¼ ì˜ ì´í•´í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!
            </p>
        </div>

        <!-- ê²°ê³¼ ë¹„êµ -->
        <div class="results-comparison">
            <div class="result-column">
                <div class="result-column-header">
                    <div class="result-column-title" id="person1Name"></div>
                    <div class="result-column-subtitle" id="person1Test"></div>
                    <div class="result-type-badge" id="person1Result"></div>
                </div>
                <div id="person1Details"></div>
            </div>

            <div class="result-column">
                <div class="result-column-header">
                    <div class="result-column-title" id="person2Name"></div>
                    <div class="result-column-subtitle" id="person2Test"></div>
                    <div class="result-type-badge" id="person2Result"></div>
                </div>
                <div id="person2Details"></div>
            </div>
        </div>

        <!-- ì¢…í•© ë¶„ì„ -->
        <div class="analysis-box">
            <h3 class="analysis-title">ğŸ’¡ ì¢…í•© ë¶„ì„</h3>
            <ul class="analysis-list" id="analysisList"></ul>
        </div>

        <!-- ê³µìœ í•˜ê¸° -->
        <div class="share-section-compare">
            <h3 style="font-size: 1.8rem; margin-bottom: 24px;">ğŸ“¤ ë¹„êµ ê²°ê³¼ ê³µìœ í•˜ê¸°</h3>
            <div style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;">
                <button class="btn-cta" onclick="shareCompareResult()">
                    <span>ğŸ“±</span> ì¹œêµ¬ì—ê²Œ ê³µìœ 
                </button>
                <button class="btn-cta btn-cta-secondary" onclick="resetComparison()">
                    <span>â†»</span> ë‹¤ì‹œ ë¹„êµí•˜ê¸°
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let selectedResult1 = null;
let selectedResult2 = null;

document.addEventListener('DOMContentLoaded', () => {
    loadSavedResults();
    setupEventListeners();
});

function loadSavedResults() {
    const savedResults = JSON.parse(localStorage.getItem('test_results') || '{}');
    const resultsArray = Object.entries(savedResults).map(([id, data]) => ({
        id,
        ...data
    }));

    if (resultsArray.length === 0) {
        document.getElementById('selectionSection').innerHTML = `
            <div style="text-align: center; padding: 80px 20px;">
                <div style="font-size: 6rem; margin-bottom: 24px;">ğŸ“­</div>
                <h2 style="font-size: 2rem; color: #4B5563; margin-bottom: 16px;">ì €ì¥ëœ ê²°ê³¼ê°€ ì—†ì–´ìš”</h2>
                <p style="font-size: 1.2rem; color: #9CA3AF; margin-bottom: 32px;">
                    ë¨¼ì € í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!
                </p>
                <a href="/" class="compare-btn" style="display: inline-block; width: auto;">í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ ê°€ê¸° â†’</a>
            </div>
        `;
        return;
    }

    // ë‚ ì§œìˆœ ì •ë ¬
    resultsArray.sort((a, b) => new Date(b.date) - new Date(a.date));

    // ì˜µì…˜ ì¶”ê°€
    const select1 = document.getElementById('result1Select');
    const select2 = document.getElementById('result2Select');

    resultsArray.forEach(result => {
        const dateStr = formatDateShort(result.date);
        const option1 = new Option(`${result.title} (${dateStr})`, result.id);
        const option2 = new Option(`${result.title} (${dateStr})`, result.id);
        select1.add(option1);
        select2.add(option2);
    });
}

function setupEventListeners() {
    document.getElementById('result1Select')?.addEventListener('change', (e) => {
        handleResultSelection(1, e.target.value);
    });

    document.getElementById('result2Select')?.addEventListener('change', (e) => {
        handleResultSelection(2, e.target.value);
    });

    document.getElementById('compareBtn')?.addEventListener('click', compareResults);
}

function handleResultSelection(selectorNum, resultId) {
    if (!resultId) {
        if (selectorNum === 1) selectedResult1 = null;
        else selectedResult2 = null;
        updateCompareButton();
        return;
    }

    const savedResults = JSON.parse(localStorage.getItem('test_results') || '{}');
    const result = savedResults[resultId];

    if (!result) return;

    if (selectorNum === 1) {
        selectedResult1 = { id: resultId, ...result };
        document.getElementById('selector1').classList.add('selected');
        document.getElementById('preview1').classList.add('show');
        document.getElementById('preview1').innerHTML = `
            <div style="font-weight: 700; margin-bottom: 8px;">${result.title}</div>
            <div style="color: #0EA5E9; font-size: 1.1rem; font-weight: 800;">${result.resultType}</div>
        `;
    } else {
        selectedResult2 = { id: resultId, ...result };
        document.getElementById('selector2').classList.add('selected');
        document.getElementById('preview2').classList.add('show');
        document.getElementById('preview2').innerHTML = `
            <div style="font-weight: 700; margin-bottom: 8px;">${result.title}</div>
            <div style="color: #0EA5E9; font-size: 1.1rem; font-weight: 800;">${result.resultType}</div>
        `;
    }

    updateCompareButton();
}

function updateCompareButton() {
    const btn = document.getElementById('compareBtn');
    if (selectedResult1 && selectedResult2) {
        btn.disabled = false;
    } else {
        btn.disabled = true;
    }
}

function compareResults() {
    if (!selectedResult1 || !selectedResult2) return;

    // ë±ƒì§€ ì‹œìŠ¤í…œì— ë¹„êµ ê¸°ë¡ (badge-system.jsê°€ ìˆìœ¼ë©´)
    if (typeof BadgeSystem !== 'undefined') {
        const badgeSystem = new BadgeSystem();
        badgeSystem.recordComparison();
    }

    // ê¶í•©ë„ ê³„ì‚°
    const compatibility = calculateCompatibility(selectedResult1, selectedResult2);

    // UI ì—…ë°ì´íŠ¸
    document.getElementById('compatScore').textContent = compatibility.score + '%';
    document.getElementById('compatGrade').textContent = compatibility.grade;
    document.getElementById('compatDescription').textContent = compatibility.description;

    // ê°™ì€ ê²°ê³¼ì¸ì§€ í™•ì¸
    if (selectedResult1.resultType === selectedResult2.resultType) {
        document.getElementById('sameResultBox').style.display = 'block';
    } else {
        document.getElementById('sameResultBox').style.display = 'none';
    }

    // ê²°ê³¼ í‘œì‹œ
    document.getElementById('person1Name').textContent = 'ì²« ë²ˆì§¸ ê²°ê³¼';
    document.getElementById('person1Test').textContent = selectedResult1.title;
    document.getElementById('person1Result').textContent = selectedResult1.resultType;

    document.getElementById('person2Name').textContent = 'ë‘ ë²ˆì§¸ ê²°ê³¼';
    document.getElementById('person2Test').textContent = selectedResult2.title;
    document.getElementById('person2Result').textContent = selectedResult2.resultType;

    // ë¶„ì„ ë¦¬ìŠ¤íŠ¸
    const analysisList = document.getElementById('analysisList');
    analysisList.innerHTML = compatibility.analysis.map(item => `<li>${item}</li>`).join('');

    // ì„¹ì…˜ ì „í™˜
    document.getElementById('selectionSection').style.display = 'none';
    document.getElementById('comparisonSection').classList.add('show');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function calculateCompatibility(result1, result2) {
    // ê°™ì€ í…ŒìŠ¤íŠ¸ì¸ì§€ í™•ì¸
    const sameTest = result1.title === result2.title;
    const sameResult = result1.resultType === result2.resultType;

    let score = 50; // ê¸°ë³¸ ì ìˆ˜
    let grade = '';
    let description = '';
    const analysis = [];

    if (sameTest && sameResult) {
        score = 100;
        grade = 'ì™„ë²½í•œ ì¡°í™”! ğŸŠ';
        description = 'ë‘ ë¶„ì€ ì™„ì „íˆ ê°™ì€ ì„±í–¥ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤. ì„œë¡œë¥¼ ë„ˆë¬´ë‚˜ ì˜ ì´í•´í•  ìˆ˜ ìˆì–´ìš”!';
        analysis.push('ê°™ì€ í…ŒìŠ¤íŠ¸ì—ì„œ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì™”ì–´ìš”');
        analysis.push('ì„œë¡œì˜ ìƒê°ê³¼ ê°ì •ì„ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
        analysis.push('ë¹„ìŠ·í•œ ê°€ì¹˜ê´€ì„ ê³µìœ í•˜ê³  ìˆì–´ìš”');
        analysis.push('í•¨ê»˜ ìˆìœ¼ë©´ í¸ì•ˆí•¨ì„ ëŠë‚„ ê±°ì˜ˆìš”');
    } else if (sameTest && !sameResult) {
        score = 75;
        grade = 'ì¢‹ì€ ê¶í•©! ğŸ’–';
        description = 'ê°™ì€ í…ŒìŠ¤íŠ¸ë¥¼ í–ˆì§€ë§Œ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì™”ë„¤ìš”. ì„œë¡œì˜ ì°¨ì´ë¥¼ ì´í•´í•˜ë©° ì„±ì¥í•  ìˆ˜ ìˆì–´ìš”!';
        analysis.push('ê°™ì€ í…ŒìŠ¤íŠ¸ì—ì„œ ë‹¤ë¥¸ ê²°ê³¼ - ìƒí˜¸ ë³´ì™„ ê´€ê³„');
        analysis.push('ì„œë¡œì˜ ë‹¤ë¥¸ ì ì„ ì¡´ì¤‘í•˜ë©´ ì¢‹ì€ ê´€ê³„ê°€ ë  ìˆ˜ ìˆì–´ìš”');
        analysis.push('ë‹¤ì–‘ì„± ì†ì—ì„œ ë°°ìš¸ ì ì´ ë§ìŠµë‹ˆë‹¤');
        analysis.push('ì°¨ì´ë¥¼ ì¸ì •í•˜ê³  ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”');
    } else {
        score = 60;
        grade = 'í¥ë¯¸ë¡œìš´ ì¡°í•©! âœ¨';
        description = 'ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ì…¨ë„¤ìš”! ê°ìì˜ ê°œì„±ì´ ëšœë ·í•´ì„œ ì„œë¡œì—ê²Œ ì‹ ì„ í•œ ìê·¹ì´ ë  ìˆ˜ ìˆì–´ìš”.';
        analysis.push('ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ë¡œ ê°ìì˜ íŠ¹ì„±ì„ ì•Œì•„ë³´ì…¨ì–´ìš”');
        analysis.push('ì„œë¡œì˜ ê°œì„±ì„ ì¡´ì¤‘í•˜ë©´ ì¢‹ì€ ê´€ê³„ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
        analysis.push('ë‹¤ì–‘í•œ ê´€ì ì—ì„œ ì„œë¡œë¥¼ ì´í•´í•´ë³´ì„¸ìš”');
        analysis.push('í•¨ê»˜ ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ëŠ” ê²ƒì„ ì¶”ì²œë“œë ¤ìš”!');
    }

    return { score, grade, description, analysis };
}

function formatDateShort(dateString) {
    const date = new Date(dateString);
    return `${date.getMonth() + 1}/${date.getDate()}`;
}

function resetComparison() {
    document.getElementById('selectionSection').style.display = 'block';
    document.getElementById('comparisonSection').classList.remove('show');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function shareCompareResult() {
    const text = `ìš°ë¦¬ ê¶í•©ì€ ${document.getElementById('compatScore').textContent}! ë„ˆë„ í•´ë³¼ë˜?`;
    const url = window.location.origin;

    if (navigator.share) {
        navigator.share({
            title: 'ì¹œêµ¬ì™€ ê²°ê³¼ ë¹„êµí•˜ê¸°',
            text: text,
            url: url
        }).catch(() => {});
    } else {
        alert('ì´ ê²°ê³¼ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•´ë³´ì„¸ìš”!\n\n' + text + '\n' + url);
    }
}
</script>
{{ end }}
