{{ define "head" }}
<link rel="stylesheet" href="/css/fortune.css">
<style>
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
        background: linear-gradient(180deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
        min-height: 100vh;
    }

    /* ì…ë ¥ í™”ë©´ ìŠ¤íƒ€ì¼ */
    .fortune-input-container {
        max-width: 800px;
        margin: 60px auto;
        padding: 60px 40px;
        text-align: center;
    }

    .fortune-input-title {
        font-size: 2.5rem;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        font-weight: 900;
    }

    .fortune-input-subtitle {
        color: #fef3c7;
        font-size: 1.2rem;
        margin-bottom: 40px;
        line-height: 1.9;
        font-weight: 400;
        opacity: 0.95;
    }

    /* ë‚ ì§œ ì…ë ¥ ê·¸ë£¹ */
    .date-input-group {
        background: rgba(251, 191, 36, 0.08);
        border: 2px solid rgba(251, 191, 36, 0.3);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        transition: all 0.3s ease;
    }

    .date-input-group:hover {
        border-color: #fbbf24;
        background: rgba(251, 191, 36, 0.12);
    }

    .date-input-label {
        color: #fbbf24;
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 16px;
        display: block;
        text-align: center;
    }

    .date-input {
        width: 100%;
        padding: 18px;
        border-radius: 12px;
        border: 2px solid rgba(251, 191, 36, 0.4);
        background: rgba(255, 255, 255, 0.95);
        color: #1e293b;
        font-size: 1.1rem;
        font-weight: 600;
        text-align: center;
        box-sizing: border-box;
        transition: all 0.3s ease;
    }

    .date-input:focus {
        outline: none;
        border-color: #fbbf24;
        background: white;
        box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.2);
    }

    /* ëª¨ë°”ì¼ì—ì„œ ìˆ«ì í‚¤íŒ¨ë“œ í‘œì‹œ */
    .date-input::placeholder {
        color: rgba(30, 41, 59, 0.5);
    }

    .date-input::-webkit-calendar-picker-indicator {
        cursor: pointer;
        filter: invert(0.3);
    }

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
        .fortune-input-container {
            padding: 40px 20px;
        }

        .fortune-input-title {
            font-size: 2rem;
        }

        .fortune-input-subtitle {
            font-size: 1.05rem;
            line-height: 1.7;
        }

        .date-input-group {
            padding: 20px;
        }

        .date-input {
            font-size: 1rem;
            padding: 16px;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ë‹¬ë ¥ ëŒ€ì‹  ìˆ«ì ì…ë ¥ */
        .date-input[type="date"] {
            position: relative;
        }
    }

    /* ê¶í•© ì ìˆ˜ ì„¹ì…˜ */
    .compatibility-score-section {
        text-align: center;
        margin-bottom: 40px;
    }

    .compatibility-score-title {
        font-size: 2rem;
        background: linear-gradient(135deg, #ec4899, #f43f5e);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
        margin-bottom: 12px;
    }

    .heart-score {
        font-size: 5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 16px 0;
        text-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
    }

    .heart-grade {
        font-size: 2rem;
        color: #fbbf24;
        font-weight: 700;
        margin-top: 12px;
    }

    .heart-grade-desc {
        font-size: 1.2rem;
        color: #cbd5e1;
        margin-top: 16px;
    }

    .heart-gauge {
        width: 100%;
        max-width: 600px;
        height: 50px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 25px;
        overflow: hidden;
        margin: 30px auto;
        border: 2px solid rgba(251, 191, 36, 0.3);
    }

    .heart-gauge-fill {
        height: 100%;
        background: linear-gradient(90deg, #fbbf24, #f59e0b, #ec4899);
        border-radius: 25px;
        transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 20px;
        font-size: 1.8rem;
        box-shadow: 0 4px 20px rgba(251, 191, 36, 0.4);
    }

    /* ì‚¬ëŒ ì •ë³´ ê·¸ë¦¬ë“œ */
    .person-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .person-info-box {
        background: rgba(251, 191, 36, 0.08);
        border: 2px solid rgba(251, 191, 36, 0.3);
        border-radius: 20px;
        padding: 30px;
    }

    .person-info-title {
        font-size: 1.3rem;
        color: #fbbf24;
        font-weight: 800;
        margin-bottom: 20px;
        text-align: center;
    }

    .person-info-content {
        color: #e2e8f0;
        line-height: 1.8;
    }

    .person-info-content p {
        margin: 12px 0;
    }

    .person-info-content strong {
        color: #fbbf24;
    }

    .person-traits {
        color: #cbd5e1;
        font-size: 0.95rem;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(251, 191, 36, 0.2);
    }

    /* ê³µìœ  ì„¹ì…˜ */
    .share-section {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(236, 72, 153, 0.15));
        border-radius: 20px;
        padding: 36px;
        text-align: center;
        border: 2px solid rgba(251, 191, 36, 0.3);
        margin-top: 40px;
    }

    .share-title {
        font-size: 1.4rem;
        color: #fbbf24;
        margin-bottom: 24px;
        font-weight: 800;
    }

    .share-buttons {
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .btn-share {
        padding: 14px 32px;
        border: none;
        border-radius: 50px;
        font-size: 1.05rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-share-kakao {
        background: linear-gradient(135deg, #FEE500, #FDD835);
        color: #3C1E1E;
    }

    .btn-share-kakao:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(254, 229, 0, 0.4);
    }

    .btn-share-link {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: white;
    }

    .btn-share-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
    }

    .btn-share:active {
        transform: translateY(0);
    }

    /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ */
    .btn-reset {
        padding: 14px 40px;
        background: transparent;
        color: #fbbf24;
        border: 2px solid #fbbf24;
        border-radius: 50px;
        font-size: 1.05rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 30px;
    }

    .btn-reset:hover {
        background: rgba(251, 191, 36, 0.1);
        transform: translateY(-2px);
    }

    .btn-reset:active {
        transform: translateY(0);
    }

    /* ê¶í•© ìƒì„¸ ì •ë³´ ë°•ìŠ¤ */
    .compat-detail-box {
        background: rgba(251, 191, 36, 0.05);
        border: 2px solid rgba(251, 191, 36, 0.3);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 20px;
    }

    .compat-detail-title {
        font-size: 1.4rem;
        color: #fbbf24;
        font-weight: 800;
        margin-bottom: 20px;
    }

    .compat-detail-content {
        color: #e2e8f0;
        line-height: 1.9;
    }

    .compat-detail-content p {
        margin: 12px 0;
    }

    .compat-detail-list {
        color: #e2e8f0;
        line-height: 2;
        padding-left: 20px;
        margin: 16px 0;
    }

    .compat-detail-list li {
        margin: 8px 0;
    }

    /* ê¶í•©í™•ì¸í•˜ê¸° ë²„íŠ¼ */
    .submit-button {
        width: 100%;
        max-width: 400px;
        padding: 20px 48px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1e1b4b;
        border: none;
        border-radius: 50px;
        font-size: 1.3rem;
        font-weight: 800;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4);
        display: block;
        margin: 0 auto;
        letter-spacing: -0.02em;
    }

    .submit-button:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 12px 32px rgba(251, 191, 36, 0.6);
        background: linear-gradient(135deg, #fcd34d, #fbbf24);
    }

    .submit-button:active {
        transform: translateY(-2px) scale(1);
    }

    /* ì´ë¯¸ì§€ ì €ì¥ ë²„íŠ¼ */
    .btn-share-image {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
    }

    .btn-share-image:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4);
    }

    @media (max-width: 768px) {
        .date-input-group {
            padding: 20px;
        }

        .person-info-grid {
            grid-template-columns: 1fr;
        }

        .heart-score {
            font-size: 4rem;
        }

        .compatibility-score-title {
            font-size: 1.6rem;
        }

        .heart-grade {
            font-size: 1.6rem;
        }

        .heart-gauge {
            height: 40px;
        }

        .heart-gauge-fill {
            font-size: 1.4rem;
        }

        .share-buttons {
            flex-direction: column;
        }

        .btn-share {
            width: 100%;
        }
    }
</style>
{{ end }}

{{ define "main" }}
<div class="fortune-page">
    <div style="position: relative; z-index: 1;">

        <!-- ì…ë ¥ ì„¹ì…˜ -->
        <div id="inputSection" class="fortune-input-container">
            <h2 class="fortune-input-title">ğŸ’• ê¶í•©ë³´ê¸°</h2>
            <p class="fortune-input-subtitle">
                ë‘ ì‚¬ëŒì˜ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì‹œë©´<br>
                ë³„ìë¦¬ì™€ ë ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê¶í•©ì„ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤ âœ¨
            </p>

            <div class="date-input-group">
                <label class="date-input-label">ğŸ‘¤ ì²« ë²ˆì§¸ ì‚¬ëŒ ìƒë…„ì›”ì¼</label>
                <input type="text" id="birthDate1" class="date-input" placeholder="YYYY-MM-DD (ì˜ˆ: 1995-03-21)" pattern="\d{4}-\d{2}-\d{2}" inputmode="numeric">
            </div>

            <div class="date-input-group">
                <label class="date-input-label">ğŸ‘¤ ë‘ ë²ˆì§¸ ì‚¬ëŒ ìƒë…„ì›”ì¼</label>
                <input type="text" id="birthDate2" class="date-input" placeholder="YYYY-MM-DD (ì˜ˆ: 1997-08-15)" pattern="\d{4}-\d{2}-\d{2}" inputmode="numeric">
            </div>

            <button id="submitButton" class="submit-button">
                ê¶í•© í™•ì¸í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div id="resultSection" class="fortune-result-container" style="display: none;">
            <!-- ê¶í•© ì ìˆ˜ -->
            <div class="compatibility-score-section">
                <div class="compatibility-score-title">ğŸ’• ê¶í•© ì ìˆ˜</div>
                <div id="resultScore" class="heart-score"></div>
                <div id="resultGrade" class="heart-grade"></div>

                <div class="heart-gauge">
                    <div id="heartGaugeFill" class="heart-gauge-fill" style="width: 0%;">â¤ï¸</div>
                </div>

                <div id="resultGradeDesc" class="heart-grade-desc"></div>
            </div>

            <!-- ê° ì‚¬ëŒ ì •ë³´ -->
            <div class="person-info-grid">
                <div class="person-info-box">
                    <div class="person-info-title">ğŸ‘¤ ì²« ë²ˆì§¸ ì‚¬ëŒ</div>
                    <div id="person1Info" class="person-info-content"></div>
                </div>
                <div class="person-info-box">
                    <div class="person-info-title">ğŸ‘¤ ë‘ ë²ˆì§¸ ì‚¬ëŒ</div>
                    <div id="person2Info" class="person-info-content"></div>
                </div>
            </div>

            <!-- ë³„ìë¦¬ ê¶í•© -->
            <div class="compat-detail-box">
                <div class="compat-detail-title">â­ ë³„ìë¦¬ ê¶í•© (<span id="zodiacScore"></span>ì )</div>
                <div id="zodiacCompat" class="compat-detail-content"></div>
            </div>

            <!-- ë  ê¶í•© -->
            <div class="compat-detail-box">
                <div class="compat-detail-title">ğŸ‰ ë  ê¶í•© (<span id="chineseScore"></span>ì )</div>
                <div id="chineseCompat" class="compat-detail-content"></div>
            </div>

            <!-- ê´€ê³„ ë¶„ì„ ì•„ì½”ë””ì–¸ -->
            <div class="accordion-section" style="margin-bottom: 24px;">
                <button class="accordion-header" onclick="toggleAccordion('relationshipAnalysis')"
                        style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2));
                        border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer;
                        display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;"
                        onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))';
                                     this.style.transform='translateY(-2px)';
                                     this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';"
                        onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))';
                                    this.style.transform='translateY(0)';
                                    this.style.boxShadow='none';">
                    <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸ’ ê´€ê³„ ë¶„ì„ ë³´ê¸°</span>
                    <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                </button>
                <div id="relationshipAnalysis" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.3s ease;">
                    <div class="accordion-inner" style="padding-top: 20px;">
                        <!-- ì¥ì  -->
                        <div class="compat-detail-box">
                            <div class="compat-detail-title">âœ¨ ì´ ê´€ê³„ì˜ ì¥ì </div>
                            <ul id="strengthsList" class="compat-detail-list"></ul>
                        </div>

                        <!-- ì£¼ì˜ì‚¬í•­ -->
                        <div class="compat-detail-box">
                            <div class="compat-detail-title">âš ï¸ ì£¼ì˜í•  ì </div>
                            <ul id="cautionsList" class="compat-detail-list"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì—°ì•  ê°€ì´ë“œ ì•„ì½”ë””ì–¸ -->
            <div class="accordion-section" style="margin-bottom: 24px;">
                <button class="accordion-header" onclick="toggleAccordion('loveGuide')"
                        style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2));
                        border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer;
                        display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;"
                        onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))';
                                     this.style.transform='translateY(-2px)';
                                     this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';"
                        onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))';
                                    this.style.transform='translateY(0)';
                                    this.style.boxShadow='none';">
                    <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸ’• ì—°ì•  ê°€ì´ë“œ ë³´ê¸°</span>
                    <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                </button>
                <div id="loveGuide" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.3s ease;">
                    <div class="accordion-inner" style="padding-top: 20px;">
                        <!-- ì¡°ì–¸ -->
                        <div class="compat-detail-box">
                            <div class="compat-detail-title">ğŸ’¡ ì—°ì•  ì¡°ì–¸</div>
                            <div id="loveAdvice" class="compat-detail-content"></div>
                        </div>

                        <!-- ë°ì´íŠ¸ ì•„ì´ë””ì–´ -->
                        <div class="compat-detail-box">
                            <div class="compat-detail-title">ğŸ’‘ ì¶”ì²œ ë°ì´íŠ¸ ì•„ì´ë””ì–´</div>
                            <ul id="dateIdeasList" class="compat-detail-list"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì‹¬í™” ì¡°ì–¸ ì•„ì½”ë””ì–¸ -->
            <div class="accordion-section" style="margin-bottom: 40px;">
                <button class="accordion-header" onclick="toggleAccordion('advancedTips')"
                        style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2));
                        border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer;
                        display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;"
                        onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))';
                                     this.style.transform='translateY(-2px)';
                                     this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';"
                        onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))';
                                    this.style.transform='translateY(0)';
                                    this.style.boxShadow='none';">
                    <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸ”® ì‹¬í™” ì¡°ì–¸ ë³´ê¸°</span>
                    <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                </button>
                <div id="advancedTips" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.3s ease;">
                    <div class="accordion-inner" style="padding-top: 20px;">
                        <!-- ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ íŒ -->
                        <div class="compat-detail-box">
                            <div class="compat-detail-title">ğŸ’¬ ì†Œí†µ ë¹„ë²•</div>
                            <ul id="communicationTipsList" class="compat-detail-list"></ul>
                        </div>

                        <!-- ê°ˆë“± í•´ê²° ë°©ë²• -->
                        <div class="compat-detail-box">
                            <div class="compat-detail-title">ğŸ¤ ê°ˆë“± í•´ê²° ê°€ì´ë“œ</div>
                            <ul id="conflictResolutionList" class="compat-detail-list"></ul>
                        </div>

                        <!-- ì¥ê¸°ì  ì „ë§ -->
                        <div class="compat-detail-box">
                            <div class="compat-detail-title">ğŸ”® ì¥ê¸°ì  ê´€ê³„ ì „ë§</div>
                            <ul id="longTermOutlookList" class="compat-detail-list"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³µìœ í•˜ê¸° -->
            <div class="share-section">
                <h4 class="share-title">ğŸ’¬ ê²°ê³¼ë¥¼ ê³µìœ í•˜ê¸°</h4>
                <div class="share-buttons">
                    <button onclick="downloadCompatibilityImage()" class="btn-share btn-share-image" id="downloadBtn">
                        <span style="font-size: 1.3rem;">ğŸ“¸</span> <span class="download-text">ì´ë¯¸ì§€ ì €ì¥</span>
                    </button>
                    <button onclick="shareKakao()" class="btn-share btn-share-kakao">
                        <span style="font-size: 1.3rem;">ğŸ’¬</span> ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
                    </button>
                    <button onclick="copyLink()" class="btn-share btn-share-link" id="copyBtn">
                        <span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬
                    </button>
                </div>
            </div>

            <!-- ë‹¤ì‹œí•˜ê¸° -->
            <div style="text-align: center;">
                <button onclick="resetCompatibility()" class="btn-reset">
                    â†» ë‹¤ë¥¸ ê¶í•© ë³´ê¸°
                </button>
            </div>
        </div>

    </div>
</div>

<script src="/js/fortune-engine.js"></script>
<script>
    const birthDate1Input = document.getElementById('birthDate1');
    const birthDate2Input = document.getElementById('birthDate2');
    const submitButton = document.getElementById('submitButton');
    const inputSection = document.getElementById('inputSection');
    const resultSection = document.getElementById('resultSection');

    submitButton.addEventListener('click', showCompatibility);

    // ë‚ ì§œ í˜•ì‹ ê²€ì¦ í•¨ìˆ˜
    function isValidDateFormat(dateString) {
        // YYYY-MM-DD í˜•ì‹ ì²´í¬
        const regex = /^\d{4}-\d{2}-\d{2}$/;
        if (!regex.test(dateString)) {
            return false;
        }

        // ì‹¤ì œ ë‚ ì§œ ìœ íš¨ì„± ì²´í¬
        const date = new Date(dateString);
        return !isNaN(date.getTime());
    }

    function showCompatibility() {
        const date1 = birthDate1Input.value.trim();
        const date2 = birthDate2Input.value.trim();

        if (!date1 || !date2) {
            alert('ë‘ ì‚¬ëŒì˜ ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        // ë‚ ì§œ í˜•ì‹ ê²€ì¦
        if (!isValidDateFormat(date1)) {
            alert('ì²« ë²ˆì§¸ ìƒë…„ì›”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\nYYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(ì˜ˆ: 1995-03-21)');
            birthDate1Input.focus();
            return;
        }

        if (!isValidDateFormat(date2)) {
            alert('ë‘ ë²ˆì§¸ ìƒë…„ì›”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\nYYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(ì˜ˆ: 1997-08-15)');
            birthDate2Input.focus();
            return;
        }

        try {
            const result = getCompatibilityAnalysis(date1, date2);
            console.log('ê¶í•© ê²°ê³¼:', result);

            if (!result.found) {
                alert(result.message);
                return;
            }

            renderCompatibilityResult(result);

            inputSection.style.display = 'none';
            resultSection.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // ì•„ì½”ë””ì–¸ ì´ˆê¸°í™”
            setTimeout(() => {
                initializeAccordions();
            }, 100);

        } catch (error) {
            console.error('ê¶í•© ë¶„ì„ ì˜¤ë¥˜:', error);
            alert('ê¶í•© ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
    }

    function renderCompatibilityResult(result) {
        // ì ìˆ˜
        document.getElementById('resultScore').textContent = result.totalScore + 'ì ';
        document.getElementById('resultGrade').textContent = result.grade;
        document.getElementById('resultGradeDesc').textContent = result.gradeDescription;

        // í•˜íŠ¸ ê²Œì´ì§€ ì• ë‹ˆë©”ì´ì…˜
        setTimeout(() => {
            document.getElementById('heartGaugeFill').style.width = result.totalScore + '%';
        }, 100);

        // ì‚¬ëŒ ì •ë³´
        document.getElementById('person1Info').innerHTML = `
            <p><strong>ë³„ìë¦¬:</strong> ${result.person1.zodiacSign.icon} ${result.person1.zodiacSign.name}</p>
            <p><strong>ë :</strong> ${result.person1.chineseZodiac.icon} ${result.person1.chineseZodiac.name}</p>
            <p class="person-traits">${result.person1.traits}</p>
        `;

        document.getElementById('person2Info').innerHTML = `
            <p><strong>ë³„ìë¦¬:</strong> ${result.person2.zodiacSign.icon} ${result.person2.zodiacSign.name}</p>
            <p><strong>ë :</strong> ${result.person2.chineseZodiac.icon} ${result.person2.chineseZodiac.name}</p>
            <p class="person-traits">${result.person2.traits}</p>
        `;

        // ë³„ìë¦¬ ê¶í•©
        document.getElementById('zodiacScore').textContent = result.zodiacCompatibility.score;
        document.getElementById('zodiacCompat').innerHTML = `
            <p>${result.zodiacCompatibility.element1} ì›ì†Œì™€ ${result.zodiacCompatibility.element2} ì›ì†Œì˜ ì¡°í™”</p>
            <p style="color: #cbd5e1; margin-top: 12px;">${result.zodiacCompatibility.description}</p>
        `;

        // ë  ê¶í•©
        document.getElementById('chineseScore').textContent = result.chineseCompatibility.score;
        document.getElementById('chineseCompat').innerHTML = `
            <p>${result.chineseCompatibility.type === 'ì‚¼í•©' || result.chineseCompatibility.type === 'ìœ¡í•©' ? 'ğŸ‰ ' + result.chineseCompatibility.type + ' ê´€ê³„!' : 'ì¼ë°˜ ê¶í•©'}</p>
            <p style="color: #cbd5e1; margin-top: 12px;">${result.chineseCompatibility.description}</p>
        `;

        // ì¥ì 
        const strengthsList = document.getElementById('strengthsList');
        strengthsList.innerHTML = '';
        result.strengths.forEach(strength => {
            const li = document.createElement('li');
            li.textContent = strength;
            strengthsList.appendChild(li);
        });

        // ì£¼ì˜ì‚¬í•­
        const cautionsList = document.getElementById('cautionsList');
        cautionsList.innerHTML = '';
        result.cautions.forEach(caution => {
            const li = document.createElement('li');
            li.textContent = caution;
            cautionsList.appendChild(li);
        });

        // ì¡°ì–¸
        document.getElementById('loveAdvice').textContent = result.loveAdvice;

        // ë°ì´íŠ¸ ì•„ì´ë””ì–´
        const dateIdeasList = document.getElementById('dateIdeasList');
        dateIdeasList.innerHTML = '';
        result.dateIdeas.forEach(idea => {
            const li = document.createElement('li');
            li.textContent = idea;
            dateIdeasList.appendChild(li);
        });

        // ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ íŒ
        const communicationTipsList = document.getElementById('communicationTipsList');
        communicationTipsList.innerHTML = '';
        result.communicationTips.forEach(tip => {
            const li = document.createElement('li');
            li.textContent = tip;
            communicationTipsList.appendChild(li);
        });

        // ê°ˆë“± í•´ê²° ë°©ë²•
        const conflictResolutionList = document.getElementById('conflictResolutionList');
        conflictResolutionList.innerHTML = '';
        result.conflictResolution.forEach(method => {
            const li = document.createElement('li');
            li.textContent = method;
            conflictResolutionList.appendChild(li);
        });

        // ì¥ê¸°ì  ì „ë§
        const longTermOutlookList = document.getElementById('longTermOutlookList');
        longTermOutlookList.innerHTML = '';
        result.longTermOutlook.forEach(outlook => {
            const li = document.createElement('li');
            li.textContent = outlook;
            longTermOutlookList.appendChild(li);
        });
    }

    function resetCompatibility() {
        inputSection.style.display = 'block';
        resultSection.style.display = 'none';
        birthDate1Input.value = '';
        birthDate2Input.value = '';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function shareKakao() {
        alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    }

    function copyLink() {
        const copyBtn = document.getElementById('copyBtn');
        const url = window.location.href;

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(() => {
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span style="font-size: 1.3rem;">âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                }, 2000);
            });
        }
    }

    // ì´ë¯¸ì§€ ì €ì¥ í•¨ìˆ˜
    async function downloadCompatibilityImage() {
        const downloadBtn = document.querySelector('.download-text');
        if (downloadBtn) {
            downloadBtn.textContent = 'ìƒì„± ì¤‘...';
        }

        try {
            // html2canvasê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof html2canvas === 'undefined') {
                throw new Error('html2canvasê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }

            const resultContainer = document.querySelector('.fortune-result-container');
            if (!resultContainer) {
                throw new Error('ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            // ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ ìˆ¨ê¸°ê¸° (ìº¡ì²˜ì—ì„œ ì œì™¸)
            const shareSection = document.querySelector('.share-section');
            const originalDisplay = shareSection ? shareSection.style.display : '';
            if (shareSection) shareSection.style.display = 'none';

            // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const resetBtn = resultContainer.nextElementSibling;
            const resetBtnDisplay = resetBtn ? resetBtn.style.display : '';
            if (resetBtn && resetBtn.querySelector('button[onclick="resetCompatibility()"]')) {
                resetBtn.style.display = 'none';
            }

            // ë°°ê²½ìƒ‰ ì„ì‹œ ì„¤ì •
            const originalBg = resultContainer.style.background;
            resultContainer.style.background = 'linear-gradient(135deg, #1e1b4b, #312e81)';

            // ë¸Œëœë“œ ì›Œí„°ë§ˆí¬ ì¶”ê°€
            const watermark = document.createElement('div');
            watermark.style.cssText = 'text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(251, 191, 36, 0.3); font-size: 14px; color: #fbbf24; font-weight: 600;';
            watermark.innerHTML = 'âœ¨ natest.krì—ì„œ ë” ë§ì€ ìš´ì„¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!';
            resultContainer.appendChild(watermark);

            // html2canvasë¡œ ìº¡ì²˜
            const canvas = await html2canvas(resultContainer, {
                backgroundColor: '#1e1b4b',
                scale: 2, // ê³ í•´ìƒë„
                logging: false,
                useCORS: true,
                allowTaint: true,
                width: resultContainer.scrollWidth,
                height: resultContainer.scrollHeight
            });

            // ì›Œí„°ë§ˆí¬ ì œê±°
            resultContainer.removeChild(watermark);

            // ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ ë³µì›
            if (shareSection) shareSection.style.display = originalDisplay;

            // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ë³µì›
            if (resetBtn) resetBtn.style.display = resetBtnDisplay;

            // ë°°ê²½ ë³µì›
            resultContainer.style.background = originalBg;

            // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
            canvas.toBlob((blob) => {
                if (!blob) {
                    throw new Error('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                // íŒŒì¼ëª… ìƒì„±
                const score = document.getElementById('resultScore').textContent || 'ê¶í•©';
                const today = new Date();
                const dateStr = `${today.getMonth() + 1}ì›”${today.getDate()}ì¼`;
                const fileName = `ê¶í•©ë³´ê¸°_${score}_${dateStr}.png`;

                // ë‹¤ìš´ë¡œë“œ
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                if (downloadBtn) {
                    downloadBtn.textContent = 'ì €ì¥ ì™„ë£Œ!';
                    setTimeout(() => {
                        downloadBtn.textContent = 'ì´ë¯¸ì§€ ì €ì¥';
                    }, 2000);
                }
            }, 'image/png');

        } catch (error) {
            console.error('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
            alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');

            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³µì›
            if (downloadBtn) {
                downloadBtn.textContent = 'ì´ë¯¸ì§€ ì €ì¥';
            }
        }
    }

    // ì•„ì½”ë””ì–¸ ì‹œìŠ¤í…œ
    function toggleAccordion(id) {
        const content = document.getElementById(id);
        const button = content.previousElementSibling;
        const icon = button.querySelector('.accordion-icon');

        if (content.style.maxHeight && content.style.maxHeight !== '0px') {
            // ì ‘ê¸°
            content.style.maxHeight = '0px';
            content.style.opacity = '0';
            content.style.paddingTop = '0';
            content.style.paddingBottom = '0';
            icon.style.transform = 'rotate(0deg)';
            button.setAttribute('aria-expanded', 'false');
        } else {
            // í¼ì¹˜ê¸°
            content.style.maxHeight = content.scrollHeight + 'px';
            content.style.opacity = '1';
            content.style.paddingTop = '0';
            content.style.paddingBottom = '0';
            icon.style.transform = 'rotate(180deg)';
            button.setAttribute('aria-expanded', 'true');

            // ì•½ê°„ì˜ ì—¬ìœ  ê³µê°„ ì¶”ê°€
            setTimeout(() => {
                content.style.maxHeight = (content.scrollHeight + 50) + 'px';
            }, 100);
        }
    }

    function initializeAccordions() {
        const isMobile = window.innerWidth <= 768;
        const accordions = ['relationshipAnalysis', 'loveGuide', 'advancedTips'];

        accordions.forEach(id => {
            const content = document.getElementById(id);
            const button = content.previousElementSibling;
            const icon = button.querySelector('.accordion-icon');

            if (isMobile) {
                // ëª¨ë°”ì¼: ê¸°ë³¸ ì ‘í˜
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                icon.style.transform = 'rotate(0deg)';
                button.setAttribute('aria-expanded', 'false');
            } else {
                // PC: ê¸°ë³¸ í¼ì¹¨
                content.style.maxHeight = (content.scrollHeight + 50) + 'px';
                content.style.opacity = '1';
                icon.style.transform = 'rotate(180deg)';
                button.setAttribute('aria-expanded', 'true');
            }
        });
    }

    // Resize handler with debounce
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            const accordions = ['relationshipAnalysis', 'loveGuide', 'advancedTips'];
            accordions.forEach(id => {
                const content = document.getElementById(id);
                if (content.style.opacity === '1') {
                    content.style.maxHeight = (content.scrollHeight + 50) + 'px';
                }
            });
        }, 250);
    });
</script>

{{ end }}
