{{ define "head" }}
<link rel="stylesheet" href="/css/fortune.css">
<style>
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
        background: linear-gradient(180deg, #0f172a 0%, #1e1b4b 50%, #7c2d12 100%);
        min-height: 100vh;
    }

    .date-input-group {
        background: rgba(251, 191, 36, 0.05);
        border: 2px solid rgba(251, 191, 36, 0.2);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
    }

    .date-input-label {
        color: #fbbf24;
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 16px;
        display: block;
        text-align: center;
    }

    .date-input {
        width: 100%;
        padding: 16px;
        border-radius: 12px;
        border: 2px solid rgba(251, 191, 36, 0.3);
        background: rgba(15, 23, 42, 0.5);
        color: white;
        font-size: 1.1rem;
        text-align: center;
        box-sizing: border-box;
    }

    .date-input:focus {
        outline: none;
        border-color: #fbbf24;
    }

    .heart-score {
        font-size: 5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #ec4899, #f43f5e);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .heart-gauge {
        width: 100%;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        overflow: hidden;
        margin: 20px 0;
    }

    .heart-gauge-fill {
        height: 100%;
        background: linear-gradient(90deg, #ec4899, #f43f5e, #ef4444);
        border-radius: 20px;
        transition: width 1s ease;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 20px;
        font-size: 1.5rem;
    }

    @media (max-width: 768px) {
        .date-input-group {
            padding: 20px;
        }
    }
</style>
{{ end }}

{{ define "main" }}
<div class="fortune-page">
    <div style="position: relative; z-index: 1;">

        <!-- ì…ë ¥ ì„¹ì…˜ -->
        <div id="inputSection" class="fortune-input-container">
            <h2 class="fortune-input-title">ğŸ’• ê¶í•©ë³´ê¸°</h2>
            <p class="fortune-input-subtitle">
                ë‘ ì‚¬ëŒì˜ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì‹œë©´<br>
                ë³„ìë¦¬ì™€ ë ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê¶í•©ì„ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤ âœ¨
            </p>

            <div class="date-input-group">
                <label class="date-input-label">ğŸ‘¤ ì²« ë²ˆì§¸ ì‚¬ëŒ ìƒë…„ì›”ì¼</label>
                <input type="date" id="birthDate1" class="date-input">
            </div>

            <div class="date-input-group">
                <label class="date-input-label">ğŸ‘¤ ë‘ ë²ˆì§¸ ì‚¬ëŒ ìƒë…„ì›”ì¼</label>
                <input type="date" id="birthDate2" class="date-input">
            </div>

            <button id="submitButton" class="submit-button">
                ê¶í•© í™•ì¸í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div id="resultSection" class="fortune-result-container" style="display: none;">
            <!-- ê¶í•© ì ìˆ˜ -->
            <div style="text-align: center; margin-bottom: 40px;">
                <div style="font-size: 2rem; color: #ec4899; font-weight: 800; margin-bottom: 12px;">ğŸ’• ê¶í•© ì ìˆ˜</div>
                <div id="resultScore" class="heart-score"></div>
                <div id="resultGrade" style="font-size: 2rem; color: #f472b6; font-weight: 700; margin-top: 12px;"></div>

                <div class="heart-gauge">
                    <div id="heartGaugeFill" class="heart-gauge-fill" style="width: 0%;">â¤ï¸</div>
                </div>

                <div id="resultGradeDesc" style="font-size: 1.2rem; color: #fbbf24; margin-top: 16px;"></div>
            </div>

            <!-- ê° ì‚¬ëŒ ì •ë³´ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px;">
                <div class="message-box">
                    <div class="message-box-title">ğŸ‘¤ ì²« ë²ˆì§¸ ì‚¬ëŒ</div>
                    <div id="person1Info" style="line-height: 1.8;"></div>
                </div>
                <div class="message-box">
                    <div class="message-box-title">ğŸ‘¤ ë‘ ë²ˆì§¸ ì‚¬ëŒ</div>
                    <div id="person2Info" style="line-height: 1.8;"></div>
                </div>
            </div>

            <!-- ë³„ìë¦¬ ê¶í•© -->
            <div class="message-box">
                <div class="message-box-title">â­ ë³„ìë¦¬ ê¶í•© (<span id="zodiacScore"></span>ì )</div>
                <div id="zodiacCompat"></div>
            </div>

            <!-- ë  ê¶í•© -->
            <div class="message-box">
                <div class="message-box-title">ğŸ‰ ë  ê¶í•© (<span id="chineseScore"></span>ì )</div>
                <div id="chineseCompat"></div>
            </div>

            <!-- ì¥ì  -->
            <div class="message-box">
                <div class="message-box-title">âœ¨ ì´ ê´€ê³„ì˜ ì¥ì </div>
                <ul id="strengthsList" style="color: #e2e8f0; line-height: 2; padding-left: 20px;"></ul>
            </div>

            <!-- ì£¼ì˜ì‚¬í•­ -->
            <div class="message-box">
                <div class="message-box-title">âš ï¸ ì£¼ì˜í•  ì </div>
                <ul id="cautionsList" style="color: #e2e8f0; line-height: 2; padding-left: 20px;"></ul>
            </div>

            <!-- ì¡°ì–¸ -->
            <div class="message-box">
                <div class="message-box-title">ğŸ’¡ ì—°ì•  ì¡°ì–¸</div>
                <div id="loveAdvice" style="color: #e2e8f0; line-height: 1.9;"></div>
            </div>

            <!-- ê³µìœ í•˜ê¸° -->
            <div class="share-section-fortune" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.15), rgba(239, 68, 68, 0.15)); border-radius: 20px; padding: 36px; text-align: center; border: 2px solid rgba(236, 72, 153, 0.3);">
                <h4 style="font-size: 1.4rem; color: #ec4899; margin-bottom: 24px; font-weight: 800;">ğŸ’¬ ê²°ê³¼ë¥¼ ê³µìœ í•˜ê¸°</h4>
                <div style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;">
                    <button onclick="shareKakao()" style="padding: 14px 32px; background: linear-gradient(135deg, #FEE500, #FDD835); color: #3C1E1E; border: none; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer;">
                        <span style="font-size: 1.3rem;">ğŸ’¬</span> ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
                    </button>
                    <button onclick="copyLink()" style="padding: 14px 32px; background: linear-gradient(135deg, #ec4899, #f43f5e); color: white; border: none; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer;" id="copyBtn">
                        <span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬
                    </button>
                </div>
            </div>

            <!-- ë‹¤ì‹œí•˜ê¸° -->
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="resetCompatibility()" style="padding: 14px 40px; background: transparent; color: #ec4899; border: 2px solid #ec4899; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer;">
                    â†» ë‹¤ë¥¸ ê¶í•© ë³´ê¸°
                </button>
            </div>
        </div>

    </div>
</div>

<script src="/js/fortune-engine.js"></script>
<script>
    const birthDate1Input = document.getElementById('birthDate1');
    const birthDate2Input = document.getElementById('birthDate2');
    const submitButton = document.getElementById('submitButton');
    const inputSection = document.getElementById('inputSection');
    const resultSection = document.getElementById('resultSection');

    submitButton.addEventListener('click', showCompatibility);

    function showCompatibility() {
        const date1 = birthDate1Input.value;
        const date2 = birthDate2Input.value;

        if (!date1 || !date2) {
            alert('ë‘ ì‚¬ëŒì˜ ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        try {
            const result = getCompatibilityAnalysis(date1, date2);
            console.log('ê¶í•© ê²°ê³¼:', result);

            if (!result.found) {
                alert(result.message);
                return;
            }

            renderCompatibilityResult(result);

            inputSection.style.display = 'none';
            resultSection.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });

        } catch (error) {
            console.error('ê¶í•© ë¶„ì„ ì˜¤ë¥˜:', error);
            alert('ê¶í•© ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
    }

    function renderCompatibilityResult(result) {
        // ì ìˆ˜
        document.getElementById('resultScore').textContent = result.totalScore + 'ì ';
        document.getElementById('resultGrade').textContent = result.grade;
        document.getElementById('resultGradeDesc').textContent = result.gradeDescription;

        // í•˜íŠ¸ ê²Œì´ì§€ ì• ë‹ˆë©”ì´ì…˜
        setTimeout(() => {
            document.getElementById('heartGaugeFill').style.width = result.totalScore + '%';
        }, 100);

        // ì‚¬ëŒ ì •ë³´
        document.getElementById('person1Info').innerHTML = `
            <p><strong>ë³„ìë¦¬:</strong> ${result.person1.zodiacSign.icon} ${result.person1.zodiacSign.name}</p>
            <p><strong>ë :</strong> ${result.person1.chineseZodiac.icon} ${result.person1.chineseZodiac.name}</p>
            <p style="color: #cbd5e1; font-size: 0.95rem;">${result.person1.traits}</p>
        `;

        document.getElementById('person2Info').innerHTML = `
            <p><strong>ë³„ìë¦¬:</strong> ${result.person2.zodiacSign.icon} ${result.person2.zodiacSign.name}</p>
            <p><strong>ë :</strong> ${result.person2.chineseZodiac.icon} ${result.person2.chineseZodiac.name}</p>
            <p style="color: #cbd5e1; font-size: 0.95rem;">${result.person2.traits}</p>
        `;

        // ë³„ìë¦¬ ê¶í•©
        document.getElementById('zodiacScore').textContent = result.zodiacCompatibility.score;
        document.getElementById('zodiacCompat').innerHTML = `
            <p style="color: #e2e8f0; line-height: 1.8;">${result.zodiacCompatibility.element1} ì›ì†Œì™€ ${result.zodiacCompatibility.element2} ì›ì†Œì˜ ì¡°í™”</p>
            <p style="color: #cbd5e1; line-height: 1.8;">${result.zodiacCompatibility.description}</p>
        `;

        // ë  ê¶í•©
        document.getElementById('chineseScore').textContent = result.chineseCompatibility.score;
        document.getElementById('chineseCompat').innerHTML = `
            <p style="color: #e2e8f0; line-height: 1.8;">${result.chineseCompatibility.type === 'ì‚¼í•©' || result.chineseCompatibility.type === 'ìœ¡í•©' ? 'ğŸ‰ ' + result.chineseCompatibility.type + ' ê´€ê³„!' : 'ì¼ë°˜ ê¶í•©'}</p>
            <p style="color: #cbd5e1; line-height: 1.8;">${result.chineseCompatibility.description}</p>
        `;

        // ì¥ì 
        const strengthsList = document.getElementById('strengthsList');
        strengthsList.innerHTML = '';
        result.strengths.forEach(strength => {
            const li = document.createElement('li');
            li.textContent = strength;
            strengthsList.appendChild(li);
        });

        // ì£¼ì˜ì‚¬í•­
        const cautionsList = document.getElementById('cautionsList');
        cautionsList.innerHTML = '';
        result.cautions.forEach(caution => {
            const li = document.createElement('li');
            li.textContent = caution;
            cautionsList.appendChild(li);
        });

        // ì¡°ì–¸
        document.getElementById('loveAdvice').textContent = result.loveAdvice;
    }

    function resetCompatibility() {
        inputSection.style.display = 'block';
        resultSection.style.display = 'none';
        birthDate1Input.value = '';
        birthDate2Input.value = '';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function shareKakao() {
        alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    }

    function copyLink() {
        const copyBtn = document.getElementById('copyBtn');
        const url = window.location.href;

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(() => {
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span style="font-size: 1.3rem;">âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                }, 2000);
            });
        }
    }
</script>

{{ end }}
