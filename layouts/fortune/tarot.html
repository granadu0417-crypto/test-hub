{{ define "head" }}
<link rel="stylesheet" href="/css/fortune.css?v=20260102">
<style>
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
        background: linear-gradient(180deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
        min-height: 100vh;
    }

    /* ì¹´ë“œ ì„ íƒ í™”ë©´ */
    .tarot-selection-container {
        max-width: 1000px;
        margin: 60px auto;
        padding: 60px 40px;
        text-align: center;
    }

    .tarot-title {
        font-size: 2.5rem;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 16px;
        font-weight: 900;
    }

    .tarot-subtitle {
        color: #cbd5e1;
        font-size: 1.15rem;
        margin-bottom: 48px;
        line-height: 1.8;
    }

    .tarot-cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 20px;
        max-width: 900px;
        margin: 0 auto 40px;
    }

    .tarot-card {
        aspect-ratio: 2/3;
        background: linear-gradient(135deg, #312e81, #1e1b4b);
        border: 2px solid rgba(251, 191, 36, 0.3);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .tarot-card::before {
        content: 'ğŸƒ';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 3rem;
        opacity: 0.5;
    }

    .tarot-card::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .tarot-card:hover {
        transform: translateY(-10px);
        border-color: #fbbf24;
        box-shadow: 0 10px 30px rgba(251, 191, 36, 0.3);
    }

    .tarot-card:hover::after {
        opacity: 1;
    }

    .tarot-card.flipping {
        animation: flipCard 0.6s ease-in-out;
    }

    @keyframes flipCard {
        0% { transform: rotateY(0deg); }
        50% { transform: rotateY(90deg); }
        100% { transform: rotateY(0deg); }
    }

    /* ê²°ê³¼ í™”ë©´ */
    .tarot-result-container {
        max-width: 900px;
        margin: 60px auto;
        padding: 60px 40px;
        background: linear-gradient(135deg, rgba(30, 27, 75, 0.9), rgba(49, 46, 129, 0.9));
        border-radius: 32px;
        box-shadow: 0 20px 60px rgba(30, 27, 75, 0.4);
        border: 2px solid rgba(251, 191, 36, 0.3);
    }

    .tarot-card-reveal {
        text-align: center;
        margin-bottom: 40px;
    }

    .tarot-card-icon {
        font-size: 8rem;
        margin-bottom: 20px;
        filter: drop-shadow(0 4px 12px rgba(251, 191, 36, 0.4));
        animation: cardReveal 0.6s ease-out;
    }

    @keyframes cardReveal {
        0% { opacity: 0; transform: scale(0.5) rotateY(90deg); }
        100% { opacity: 1; transform: scale(1) rotateY(0deg); }
    }

    .tarot-card-name {
        font-size: 2.5rem;
        color: #fbbf24;
        font-weight: 800;
        margin-bottom: 8px;
    }

    .tarot-card-name-en {
        font-size: 1.2rem;
        color: #94a3b8;
        font-style: italic;
        margin-bottom: 16px;
    }

    .tarot-card-keyword {
        font-size: 1.1rem;
        color: #cbd5e1;
        padding: 8px 24px;
        background: rgba(251, 191, 36, 0.1);
        border-radius: 20px;
        display: inline-block;
    }

    .tarot-interpretation {
        margin: 40px 0;
    }

    .tarot-section {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 20px;
        border-left: 4px solid #fbbf24;
    }

    .tarot-section-title {
        font-size: 1.3rem;
        color: #fbbf24;
        font-weight: 700;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .tarot-section-content {
        color: #e2e8f0;
        font-size: 1.05rem;
        line-height: 1.8;
    }

    @media (max-width: 768px) {
        .tarot-cards-grid {
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
        }

        .tarot-card::before {
            font-size: 2rem;
        }

        .tarot-selection-container,
        .tarot-result-container {
            margin: 20px;
            padding: 40px 24px;
        }

        .tarot-card-icon {
            font-size: 5rem;
        }
    }
</style>
{{ end }}

{{ define "main" }}
<div class="fortune-page">
    <div style="position: relative; z-index: 1;">

        <!-- ì¹´ë“œ ì„ íƒ ì„¹ì…˜ -->
        <div id="selectionSection" class="tarot-selection-container">
            <h2 class="tarot-title">ğŸƒ ì˜¤ëŠ˜ì˜ íƒ€ë¡œ ìš´ì„¸</h2>
            <p class="tarot-subtitle">
                ë§ˆìŒì„ í¸ì•ˆí•˜ê²Œ í•˜ê³  ì§ê´€ì„ ë”°ë¼ ì¹´ë“œ í•œ ì¥ì„ ì„ íƒí•˜ì„¸ìš”.<br>
                íƒ€ë¡œ ì¹´ë“œê°€ ë‹¹ì‹ ì—ê²Œ ì „í•˜ëŠ” ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. âœ¨
            </p>

            <div class="tarot-cards-grid" id="tarotCards">
                <!-- 22ì¥ì˜ ì¹´ë“œê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <div style="color: #94a3b8; font-size: 0.95rem; margin-top: 30px;">
                ğŸ’¡ ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ìš´ì„¸ê°€ ê³µê°œë©ë‹ˆë‹¤
            </div>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div id="resultSection" class="tarot-result-container" style="display: none;">
            <!-- ì„ íƒí•œ ì¹´ë“œ í‘œì‹œ -->
            <div class="tarot-card-reveal">
                <div id="resultIcon" class="tarot-card-icon"></div>
                <h3 id="resultName" class="tarot-card-name"></h3>
                <div id="resultNameEn" class="tarot-card-name-en"></div>
                <div id="resultKeyword" class="tarot-card-keyword"></div>
            </div>

            <!-- ìš´ì„¸ í•´ì„ -->
            <div class="tarot-interpretation">
                <!-- ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€ (í•­ìƒ í‘œì‹œ) -->
                <div class="tarot-section">
                    <div class="tarot-section-title">
                        <span>âœ¨</span>
                        <span>ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€</span>
                    </div>
                    <div id="resultShort" class="tarot-section-content"></div>
                </div>

                <!-- ì„¸ë¶€ ìš´ì„¸ ì•„ì½”ë””ì–¸ -->
                <div class="accordion-section" style="margin: 24px 0;">
                    <button class="accordion-header" onclick="toggleAccordion('detailFortune')" style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2)); border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸ’« ì„¸ë¶€ ìš´ì„¸ ë³´ê¸°</span>
                        <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                    </button>
                    <div id="detailFortune" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease;">
                        <div class="accordion-inner" style="padding-top: 20px;">
                            <!-- ì• ì •ìš´ -->
                            <div class="tarot-section">
                                <div class="tarot-section-title">
                                    <span>ğŸ’–</span>
                                    <span>ì• ì •ìš´</span>
                                </div>
                                <div id="resultLove" class="tarot-section-content"></div>
                            </div>

                            <!-- ê¸ˆì „ìš´ -->
                            <div class="tarot-section">
                                <div class="tarot-section-title">
                                    <span>ğŸ’°</span>
                                    <span>ê¸ˆì „ìš´</span>
                                </div>
                                <div id="resultMoney" class="tarot-section-content"></div>
                            </div>

                            <!-- ì§ì—…ìš´ -->
                            <div class="tarot-section">
                                <div class="tarot-section-title">
                                    <span>ğŸ’¼</span>
                                    <span>ì§ì—…ìš´</span>
                                </div>
                                <div id="resultWork" class="tarot-section-content"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì¡°ì–¸ ì•„ì½”ë””ì–¸ -->
                <div class="accordion-section" style="margin: 24px 0;">
                    <button class="accordion-header" onclick="toggleAccordion('tarotAdvice')" style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2)); border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸŒŸ íƒ€ë¡œ ì¹´ë“œì˜ ì¡°ì–¸</span>
                        <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                    </button>
                    <div id="tarotAdvice" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease;">
                        <div class="accordion-inner" style="padding-top: 20px;">
                            <div class="tarot-section" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.15)); border-left-color: #f59e0b;">
                                <div id="resultAdvice" class="tarot-section-content" style="font-weight: 600; font-size: 1.1rem;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³µìœ í•˜ê¸° ì„¹ì…˜ -->
            <div class="share-section-fortune" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.15)); border-radius: 20px; padding: 36px; text-align: center; border: 2px solid rgba(251, 191, 36, 0.3);">
                <h4 style="font-size: 1.4rem; color: #fbbf24; margin-bottom: 24px; font-weight: 800;">ğŸ’¬ ê²°ê³¼ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°</h4>
                <div style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;">
                    <button onclick="downloadTarotImage()" style="padding: 14px 32px; background: linear-gradient(135deg, #f093fb, #f5576c); color: white; border: none; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 16px rgba(245, 87, 108, 0.3);" id="downloadBtn">
                        <span style="font-size: 1.3rem;">ğŸ“¸</span> <span class="download-text">ì´ë¯¸ì§€ ì €ì¥</span>
                    </button>
                    <button onclick="shareFacebook()" style="padding: 14px 32px; background: linear-gradient(135deg, #3b5998, #2d4373); color: white; border: none; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 16px rgba(59, 89, 152, 0.3);">
                        <span style="font-size: 1.3rem;">ğŸ“˜</span> í˜ì´ìŠ¤ë¶ ê³µìœ 
                    </button>
                    <button onclick="copyLink()" style="padding: 14px 32px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1e1b4b; border: none; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);" id="copyBtn">
                        <span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬
                    </button>
                </div>
            </div>

            <!-- ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ -->
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="resetTarot()" style="padding: 14px 40px; background: transparent; color: #fbbf24; border: 2px solid #fbbf24; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                    â†» ë‹¤ì‹œ ë½‘ê¸°
                </button>
            </div>
        </div>

    </div>
</div>

<script src="/js/fortune-engine.js?v=20260102"></script>
<script>
    const selectionSection = document.getElementById('selectionSection');
    const resultSection = document.getElementById('resultSection');
    const tarotCardsGrid = document.getElementById('tarotCards');

    // 22ì¥ì˜ ì¹´ë“œ ìƒì„±
    function initTarotCards() {
        const cardCount = 22;
        tarotCardsGrid.innerHTML = '';

        for (let i = 0; i < cardCount; i++) {
            const card = document.createElement('div');
            card.className = 'tarot-card';
            card.dataset.cardIndex = i;
            card.addEventListener('click', () => selectCard(i));
            tarotCardsGrid.appendChild(card);
        }
    }

    // ì¹´ë“œ ì„ íƒ
    function selectCard(cardIndex) {
        const selectedCard = tarotCardsGrid.children[cardIndex];

        // ì¹´ë“œ ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜
        selectedCard.classList.add('flipping');

        // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ê²°ê³¼ í‘œì‹œ
        setTimeout(() => {
            showTarotResult(cardIndex);
        }, 600);
    }

    // íƒ€ë¡œ ê²°ê³¼ í‘œì‹œ
    function showTarotResult(cardIndex) {
        const result = getTarotFortuneByChoice(cardIndex);
        const card = result.card;
        const upright = card.upright;

        console.log('íƒ€ë¡œ ê²°ê³¼:', result);

        // ì¹´ë“œ ì •ë³´
        document.getElementById('resultIcon').textContent = card.icon;
        document.getElementById('resultName').textContent = card.name;
        document.getElementById('resultNameEn').textContent = card.nameEn;
        document.getElementById('resultKeyword').textContent = card.keyword;

        // ìš´ì„¸ í•´ì„
        document.getElementById('resultShort').textContent = upright.short;
        document.getElementById('resultLove').textContent = upright.love;
        document.getElementById('resultMoney').textContent = upright.money;
        document.getElementById('resultWork').textContent = upright.work;
        document.getElementById('resultAdvice').textContent = upright.advice;

        // í™”ë©´ ì „í™˜
        selectionSection.style.display = 'none';
        resultSection.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ë‹¤ì‹œí•˜ê¸°
    function resetTarot() {
        selectionSection.style.display = 'block';
        resultSection.style.display = 'none';
        initTarotCards();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // í˜ì´ìŠ¤ë¶ ê³µìœ 
    function shareFacebook() {
        const url = encodeURIComponent(window.location.href);
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=600,height=400');
    }

    // ë§í¬ ë³µì‚¬
    function copyLink() {
        const copyBtn = document.getElementById('copyBtn');
        const url = window.location.href;

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(() => {
                copyBtn.innerHTML = '<span style="font-size: 1.3rem;">âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬';
                }, 2000);
            }).catch(() => {
                fallbackCopyLink(url, copyBtn);
            });
        } else {
            fallbackCopyLink(url, copyBtn);
        }
    }

    function fallbackCopyLink(url, btn) {
        const textArea = document.createElement('textarea');
        textArea.value = url;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();

        try {
            document.execCommand('copy');
            btn.innerHTML = '<span style="font-size: 1.3rem;">âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
            setTimeout(() => {
                btn.innerHTML = '<span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬';
            }, 2000);
        } catch (err) {
            alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œì°½ì˜ URLì„ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
        }

        document.body.removeChild(textArea);
    }

    // ì´ë¯¸ì§€ ì €ì¥ í•¨ìˆ˜
    async function downloadTarotImage() {
        const downloadBtn = document.querySelector('.download-text');
        if (downloadBtn) {
            downloadBtn.textContent = 'ìƒì„± ì¤‘...';
        }

        try {
            if (typeof html2canvas === 'undefined') {
                throw new Error('html2canvasê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }

            const resultContainer = document.querySelector('.tarot-result-container');
            if (!resultContainer) {
                throw new Error('ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            // ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const shareSection = document.querySelector('.share-section-fortune');
            const originalDisplay = shareSection ? shareSection.style.display : '';
            if (shareSection) shareSection.style.display = 'none';

            // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const resetBtn = resultContainer.querySelector('button[onclick="resetTarot()"]').parentElement;
            const resetBtnDisplay = resetBtn ? resetBtn.style.display : '';
            if (resetBtn) resetBtn.style.display = 'none';

            // ì›Œí„°ë§ˆí¬ ì¶”ê°€
            const watermark = document.createElement('div');
            watermark.style.cssText = 'text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(251, 191, 36, 0.3); font-size: 14px; color: #fbbf24; font-weight: 600;';
            watermark.innerHTML = 'ğŸƒ natest.krì—ì„œ ë” ë§ì€ ìš´ì„¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!';
            resultContainer.appendChild(watermark);

            // html2canvasë¡œ ìº¡ì²˜
            const canvas = await html2canvas(resultContainer, {
                backgroundColor: '#1e1b4b',
                scale: 2,
                logging: false,
                useCORS: true,
                allowTaint: true,
                width: resultContainer.scrollWidth,
                height: resultContainer.scrollHeight
            });

            // ì›Œí„°ë§ˆí¬ ì œê±°
            resultContainer.removeChild(watermark);

            // ë²„íŠ¼ë“¤ ë³µì›
            if (shareSection) shareSection.style.display = originalDisplay;
            if (resetBtn) resetBtn.style.display = resetBtnDisplay;

            // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
            canvas.toBlob((blob) => {
                if (!blob) {
                    throw new Error('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                // íŒŒì¼ëª… ìƒì„±
                const cardName = document.getElementById('resultName').textContent || 'íƒ€ë¡œ';
                const today = new Date();
                const dateStr = `${today.getMonth() + 1}ì›”${today.getDate()}ì¼`;
                const fileName = `${cardName}_íƒ€ë¡œìš´ì„¸_${dateStr}.png`;

                // ë‹¤ìš´ë¡œë“œ
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                if (downloadBtn) {
                    downloadBtn.textContent = 'ì €ì¥ ì™„ë£Œ!';
                    setTimeout(() => {
                        downloadBtn.textContent = 'ì´ë¯¸ì§€ ì €ì¥';
                    }, 2000);
                }
            }, 'image/png');

        } catch (error) {
            console.error('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
            alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');

            if (downloadBtn) {
                downloadBtn.textContent = 'ì´ë¯¸ì§€ ì €ì¥';
            }
        }
    }

    // ì•„ì½”ë””ì–¸ ì‹œìŠ¤í…œ
    function toggleAccordion(id) {
        const content = document.getElementById(id);
        const button = content.previousElementSibling;
        const icon = button.querySelector('.accordion-icon');

        if (content.style.maxHeight && content.style.maxHeight !== '0px') {
            content.style.maxHeight = '0px';
            content.style.opacity = '0';
            icon.style.transform = 'rotate(0deg)';
        } else {
            content.style.maxHeight = (content.scrollHeight + 50) + 'px';
            content.style.opacity = '1';
            icon.style.transform = 'rotate(180deg)';
            setTimeout(() => {
                content.style.maxHeight = (content.scrollHeight + 50) + 'px';
            }, 100);
        }
    }

    function initializeAccordions() {
        const isMobile = window.innerWidth <= 768;
        const accordions = ['detailFortune', 'tarotAdvice'];

        accordions.forEach(id => {
            const content = document.getElementById(id);
            const button = content.previousElementSibling;
            const icon = button.querySelector('.accordion-icon');

            if (isMobile) {
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.style.maxHeight = (content.scrollHeight + 50) + 'px';
                content.style.opacity = '1';
                icon.style.transform = 'rotate(180deg)';
            }
        });
    }

    // ê²°ê³¼ í‘œì‹œ í›„ ì•„ì½”ë””ì–¸ ì´ˆê¸°í™”
    const originalSelectCard = window.selectCard;
    window.selectCard = function() {
        if (originalSelectCard) originalSelectCard.apply(this, arguments);
        setTimeout(initializeAccordions, 300);
    };

    window.addEventListener('resize', () => {
        clearTimeout(window.resizeTimer);
        window.resizeTimer = setTimeout(() => {
            ['detailFortune', 'tarotAdvice'].forEach(id => {
                const content = document.getElementById(id);
                if (content.style.opacity === '1') {
                    content.style.maxHeight = (content.scrollHeight + 50) + 'px';
                }
            });
        }, 250);
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë“œ ì´ˆê¸°í™”
    initTarotCards();
</script>

{{ end }}
