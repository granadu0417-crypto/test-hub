{{ define "main" }}
<link rel="stylesheet" href="/css/fortune.css">

<div class="fortune-page">
    <div style="max-width: 900px; margin: 0 auto; padding: 40px 20px; position: relative; z-index: 1;">

        <!-- ì…ë ¥ ì„¹ì…˜ -->
        <div id="inputSection" class="fortune-input-container" style="background: linear-gradient(135deg, rgba(30, 27, 75, 0.95), rgba(49, 46, 129, 0.95)); backdrop-filter: blur(10px); border-radius: 32px; padding: 60px 40px; box-shadow: 0 12px 48px rgba(251, 191, 36, 0.25); border: 2px solid rgba(251, 191, 36, 0.3); text-align: center;">

            <h2 class="fortune-input-title" style="font-size: 2.5rem; background: linear-gradient(135deg, #fbbf24, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 24px; font-weight: 900; letter-spacing: -0.02em;">
                â™ˆ ë³„ìë¦¬ ì˜¤ëŠ˜ì˜ ìš´ì„¸
            </h2>

            <p style="font-size: 1.15rem; color: #cbd5e1; margin-bottom: 40px; line-height: 1.8;">
                ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë³„ìë¦¬ë¥¼ í™•ì¸í•˜ê³ <br>
                ì˜¤ëŠ˜ì˜ ìš´ì„¸ë¥¼ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤ âœ¨
            </p>

            <!-- ì›”/ì¼ ì…ë ¥ -->
            <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 30px; flex-wrap: wrap;">
                <div style="flex: 1; max-width: 200px;">
                    <label style="display: block; color: #fbbf24; font-size: 0.95rem; font-weight: 600; margin-bottom: 8px;">ì›” (Month)</label>
                    <input type="number" id="birthMonthInput"
                           placeholder="ì˜ˆ: 3"
                           min="1"
                           max="12"
                           style="width: 100%; padding: 18px; border-radius: 16px; border: 2px solid rgba(251, 191, 36, 0.3); background: rgba(15, 23, 42, 0.5); color: white; font-size: 1.15rem; text-align: center; transition: all 0.3s ease;">
                </div>
                <div style="flex: 1; max-width: 200px;">
                    <label style="display: block; color: #fbbf24; font-size: 0.95rem; font-weight: 600; margin-bottom: 8px;">ì¼ (Day)</label>
                    <input type="number" id="birthDayInput"
                           placeholder="ì˜ˆ: 21"
                           min="1"
                           max="31"
                           style="width: 100%; padding: 18px; border-radius: 16px; border: 2px solid rgba(251, 191, 36, 0.3); background: rgba(15, 23, 42, 0.5); color: white; font-size: 1.15rem; text-align: center; transition: all 0.3s ease;">
                </div>
            </div>

            <!-- ë³„ìë¦¬ ë¯¸ë¦¬ë³´ê¸° -->
            <div id="zodiacPreview" class="zodiac-preview" style="min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin-bottom: 30px; opacity: 0; transition: opacity 0.3s ease;"></div>

            <!-- í™•ì¸ ë²„íŠ¼ -->
            <button id="submitButton"
                    disabled
                    style="padding: 18px 56px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1e1b4b; border: none; border-radius: 50px; font-size: 1.25rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4); opacity: 0.5;">
                ìš´ì„¸ í™•ì¸í•˜ê¸°
            </button>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div id="resultSection" class="fortune-result-container" style="display: none; background: linear-gradient(135deg, rgba(30, 27, 75, 0.95), rgba(49, 46, 129, 0.95)); backdrop-filter: blur(10px); border-radius: 32px; padding: 60px 40px; box-shadow: 0 12px 48px rgba(251, 191, 36, 0.25); border: 2px solid rgba(251, 191, 36, 0.3);">

            <!-- ë³„ìë¦¬ í—¤ë” -->
            <div class="result-header" style="text-align: center; margin-bottom: 40px;">
                <div id="resultIcon" class="result-zodiac-icon" style="font-size: 6rem; margin-bottom: 20px; filter: drop-shadow(0 4px 12px rgba(251, 191, 36, 0.4));"></div>
                <h3 id="resultName" class="result-zodiac-name" style="font-size: 2.2rem; color: #fbbf24; font-weight: 800; margin-bottom: 12px;"></h3>
                <div id="resultInfo" style="font-size: 1.1rem; color: #cbd5e1; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;"></div>
            </div>

            <!-- ì˜¤ëŠ˜ì˜ ì¢…í•© ìš´ì„¸ -->
            <div class="result-overall-score" style="text-align: center; background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.15)); border-radius: 24px; padding: 40px; margin-bottom: 40px; border: 2px solid rgba(251, 191, 36, 0.3);">
                <h4 style="font-size: 1.3rem; color: #fbbf24; margin-bottom: 16px; font-weight: 700;">ğŸŒŸ ì˜¤ëŠ˜ì˜ ì¢…í•© ìš´ì„¸</h4>
                <div id="resultTotalScore" class="result-overall-score-value" style="font-size: 4rem; font-weight: 900; background: linear-gradient(135deg, #fbbf24, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 16px;"></div>
                <div id="resultTotalStars" class="result-overall-score-stars" style="font-size: 2rem; letter-spacing: 4px;"></div>
            </div>

            <!-- ì„¸ë¶€ ìš´ì„¸ -->
            <div class="result-scores" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px;">
                <!-- ì• ì •ìš´ -->
                <div class="result-score-card" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1)); border-radius: 20px; padding: 30px; border: 1px solid rgba(251, 191, 36, 0.2); text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 12px;">ğŸ’–</div>
                    <h5 style="font-size: 1.15rem; color: #fbbf24; margin-bottom: 12px; font-weight: 700;">ì• ì •ìš´</h5>
                    <div id="resultLoveScore" style="font-size: 2rem; color: white; font-weight: 800; margin-bottom: 8px;"></div>
                    <div id="resultLoveStars" style="font-size: 1.2rem;"></div>
                </div>

                <!-- ê¸ˆì „ìš´ -->
                <div class="result-score-card" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1)); border-radius: 20px; padding: 30px; border: 1px solid rgba(251, 191, 36, 0.2); text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 12px;">ğŸ’°</div>
                    <h5 style="font-size: 1.15rem; color: #fbbf24; margin-bottom: 12px; font-weight: 700;">ê¸ˆì „ìš´</h5>
                    <div id="resultMoneyScore" style="font-size: 2rem; color: white; font-weight: 800; margin-bottom: 8px;"></div>
                    <div id="resultMoneyStars" style="font-size: 1.2rem;"></div>
                </div>

                <!-- ì§ì—…ìš´ -->
                <div class="result-score-card" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1)); border-radius: 20px; padding: 30px; border: 1px solid rgba(251, 191, 36, 0.2); text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 12px;">ğŸ’¼</div>
                    <h5 style="font-size: 1.15rem; color: #fbbf24; margin-bottom: 12px; font-weight: 700;">ì§ì—…ìš´</h5>
                    <div id="resultWorkScore" style="font-size: 2rem; color: white; font-weight: 800; margin-bottom: 8px;"></div>
                    <div id="resultWorkStars" style="font-size: 1.2rem;"></div>
                </div>
            </div>

            <!-- í–‰ìš´ì˜ ì•„ì´í…œ -->
            <div class="result-lucky-items" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
                <div style="background: rgba(251, 191, 36, 0.1); border-radius: 16px; padding: 24px; text-align: center; border: 1px solid rgba(251, 191, 36, 0.2);">
                    <div style="font-size: 1.8rem; margin-bottom: 8px;">ğŸ¨</div>
                    <div style="font-size: 0.95rem; color: #94a3b8; margin-bottom: 8px;">í–‰ìš´ì˜ ìƒ‰</div>
                    <div id="resultLuckyColor" style="font-size: 1.3rem; color: #fbbf24; font-weight: 700;"></div>
                </div>
                <div style="background: rgba(251, 191, 36, 0.1); border-radius: 16px; padding: 24px; text-align: center; border: 1px solid rgba(251, 191, 36, 0.2);">
                    <div style="font-size: 1.8rem; margin-bottom: 8px;">ğŸ”¢</div>
                    <div style="font-size: 0.95rem; color: #94a3b8; margin-bottom: 8px;">í–‰ìš´ì˜ ìˆ«ì</div>
                    <div id="resultLuckyNumber" style="font-size: 1.3rem; color: #fbbf24; font-weight: 700;"></div>
                </div>
            </div>

            <!-- ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë©”ì‹œì§€ -->
            <div class="result-messages" style="margin-bottom: 40px;">
                <div id="resultMessages" style="display: grid; gap: 16px;"></div>
            </div>

            <!-- ê³µìœ í•˜ê¸° ì„¹ì…˜ -->
            <div class="share-section" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.15)); border-radius: 20px; padding: 36px; text-align: center; border: 2px solid rgba(251, 191, 36, 0.3);">
                <h4 style="font-size: 1.4rem; color: #fbbf24; margin-bottom: 24px; font-weight: 800;">ğŸ’¬ ê²°ê³¼ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°</h4>
                <div class="share-buttons" style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;">
                    <button class="btn-share btn-facebook" onclick="shareFacebook()" style="padding: 14px 32px; background: linear-gradient(135deg, #3b5998, #2d4373); color: white; border: none; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 16px rgba(59, 89, 152, 0.3);">
                        <span style="font-size: 1.3rem;">ğŸ“˜</span> í˜ì´ìŠ¤ë¶ ê³µìœ 
                    </button>
                    <button class="btn-share btn-copy" onclick="copyLink()" style="padding: 14px 32px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1e1b4b; border: none; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);">
                        <span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬
                    </button>
                </div>
            </div>

            <!-- ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ -->
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="resetFortune()" style="padding: 14px 40px; background: transparent; color: #fbbf24; border: 2px solid #fbbf24; border-radius: 50px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                    â†» ë‹¤ì‹œ í™•ì¸í•˜ê¸°
                </button>
            </div>
        </div>

    </div>
</div>

<script src="/js/fortune-engine.js"></script>
<script>
    const birthMonthInput = document.getElementById('birthMonthInput');
    const birthDayInput = document.getElementById('birthDayInput');
    const zodiacPreview = document.getElementById('zodiacPreview');
    const submitButton = document.getElementById('submitButton');
    const inputSection = document.getElementById('inputSection');
    const resultSection = document.getElementById('resultSection');

    // ì…ë ¥ê°’ ê²€ì¦ ë° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updatePreview() {
        const month = parseInt(birthMonthInput.value);
        const day = parseInt(birthDayInput.value);

        if (month >= 1 && month <= 12 && day >= 1 && day <= 31) {
            try {
                const zodiacKey = getZodiacByBirthdate(month, day);
                const zodiac = WESTERN_ZODIAC[zodiacKey];

                zodiacPreview.style.opacity = '1';
                zodiacPreview.innerHTML = `
                    <div style="font-size: 5rem; margin-bottom: 12px; animation: float 3s ease-in-out infinite;">${zodiac.icon}</div>
                    <div style="font-size: 1.8rem; color: #fbbf24; font-weight: 800; margin-bottom: 8px;">${zodiac.name}</div>
                    <div style="font-size: 1.05rem; color: #cbd5e1;">
                        ${zodiac.symbol} â€¢ ${zodiac.trait}
                    </div>
                `;

                submitButton.disabled = false;
                submitButton.style.opacity = '1';
                submitButton.style.cursor = 'pointer';
            } catch (e) {
                resetPreview();
            }
        } else {
            resetPreview();
        }
    }

    function resetPreview() {
        zodiacPreview.style.opacity = '0';
        zodiacPreview.innerHTML = '';
        submitButton.disabled = true;
        submitButton.style.opacity = '0.5';
        submitButton.style.cursor = 'not-allowed';
    }

    // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    birthMonthInput.addEventListener('input', updatePreview);
    birthDayInput.addEventListener('input', updatePreview);

    // Enter í‚¤ë¡œ ì œì¶œ
    birthMonthInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !submitButton.disabled) {
            showFortune();
        }
    });
    birthDayInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !submitButton.disabled) {
            showFortune();
        }
    });

    // ìš´ì„¸ í™•ì¸ ë²„íŠ¼
    submitButton.addEventListener('click', showFortune);

    // ë³„ì  í‘œì‹œ í•¨ìˆ˜
    function getStars(score) {
        const starCount = Math.round(score / 20);
        return 'â­'.repeat(starCount);
    }

    // ìš´ì„¸ ê²°ê³¼ í‘œì‹œ
    function showFortune() {
        const month = parseInt(birthMonthInput.value);
        const day = parseInt(birthDayInput.value);

        const fortune = getTodayZodiacFortune(month, day);

        // ë³„ìë¦¬ ì •ë³´
        document.getElementById('resultIcon').textContent = fortune.zodiac.icon;
        document.getElementById('resultName').textContent = fortune.zodiac.name;
        document.getElementById('resultInfo').innerHTML = `
            <span><strong>ì›ì†Œ:</strong> ${fortune.zodiac.symbol}</span>
            <span><strong>íŠ¹ì„±:</strong> ${fortune.zodiac.trait}</span>
        `;

        // ì¢…í•© ì ìˆ˜
        document.getElementById('resultTotalScore').textContent = fortune.scores.total + 'ì ';
        document.getElementById('resultTotalStars').textContent = getStars(fortune.scores.total);

        // ì„¸ë¶€ ì ìˆ˜
        document.getElementById('resultLoveScore').textContent = fortune.scores.love + 'ì ';
        document.getElementById('resultLoveStars').textContent = getStars(fortune.scores.love);

        document.getElementById('resultMoneyScore').textContent = fortune.scores.money + 'ì ';
        document.getElementById('resultMoneyStars').textContent = getStars(fortune.scores.money);

        document.getElementById('resultWorkScore').textContent = fortune.scores.work + 'ì ';
        document.getElementById('resultWorkStars').textContent = getStars(fortune.scores.work);

        // í–‰ìš´ì˜ ì•„ì´í…œ
        document.getElementById('resultLuckyColor').textContent = fortune.luckyColor;
        document.getElementById('resultLuckyNumber').textContent = fortune.luckyNumber;

        // ìš´ì„¸ ë©”ì‹œì§€
        const messagesHtml = fortune.messages.map(msg => `
            <div style="background: rgba(251, 191, 36, 0.1); border-left: 4px solid #fbbf24; border-radius: 12px; padding: 20px; color: #e2e8f0; font-size: 1.05rem; line-height: 1.8;">
                ${msg}
            </div>
        `).join('');
        document.getElementById('resultMessages').innerHTML = messagesHtml;

        // í™”ë©´ ì „í™˜
        inputSection.style.display = 'none';
        resultSection.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ë‹¤ì‹œí•˜ê¸°
    function resetFortune() {
        inputSection.style.display = 'block';
        resultSection.style.display = 'none';
        birthMonthInput.value = '';
        birthDayInput.value = '';
        resetPreview();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // í˜ì´ìŠ¤ë¶ ê³µìœ 
    function shareFacebook() {
        const url = encodeURIComponent(window.location.href);
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=600,height=400');
    }

    // ë§í¬ ë³µì‚¬
    function copyLink() {
        const copyBtn = event.currentTarget;
        const url = window.location.href;

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(() => {
                copyBtn.innerHTML = '<span style="font-size: 1.3rem;">âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬';
                }, 2000);
            }).catch(() => {
                fallbackCopyLink(url, copyBtn);
            });
        } else {
            fallbackCopyLink(url, copyBtn);
        }
    }

    function fallbackCopyLink(url, btn) {
        const textArea = document.createElement('textarea');
        textArea.value = url;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();

        try {
            document.execCommand('copy');
            btn.innerHTML = '<span style="font-size: 1.3rem;">âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
            setTimeout(() => {
                btn.innerHTML = '<span style="font-size: 1.3rem;">ğŸ”—</span> ë§í¬ ë³µì‚¬';
            }, 2000);
        } catch (err) {
            alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œì°½ì˜ URLì„ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
        }

        document.body.removeChild(textArea);
    }

    // Input í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼
    birthMonthInput.addEventListener('focus', function() {
        this.style.borderColor = '#fbbf24';
        this.style.boxShadow = '0 0 0 3px rgba(251, 191, 36, 0.2)';
    });
    birthMonthInput.addEventListener('blur', function() {
        this.style.borderColor = 'rgba(251, 191, 36, 0.3)';
        this.style.boxShadow = 'none';
    });

    birthDayInput.addEventListener('focus', function() {
        this.style.borderColor = '#fbbf24';
        this.style.boxShadow = '0 0 0 3px rgba(251, 191, 36, 0.2)';
    });
    birthDayInput.addEventListener('blur', function() {
        this.style.borderColor = 'rgba(251, 191, 36, 0.3)';
        this.style.boxShadow = 'none';
    });

    // í˜¸ë²„ íš¨ê³¼
    submitButton.addEventListener('mouseenter', function() {
        if (!this.disabled) {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 8px 28px rgba(251, 191, 36, 0.5)';
        }
    });
    submitButton.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 6px 20px rgba(251, 191, 36, 0.4)';
    });
</script>

{{ end }}
