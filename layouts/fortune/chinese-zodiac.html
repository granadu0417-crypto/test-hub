{{ define "head" }}
<link rel="stylesheet" href="/css/fortune.css?v=20260102">
<style>
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
        background: linear-gradient(180deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
        min-height: 100vh;
    }

    /* ì…ë ¥ í™”ë©´ */
    .fortune-input-container {
        max-width: 600px;
        margin: 60px auto;
        padding: 60px 40px;
        background: linear-gradient(135deg, rgba(30, 27, 75, 0.9), rgba(49, 46, 129, 0.9));
        border-radius: 32px;
        box-shadow: 0 20px 60px rgba(30, 27, 75, 0.4);
        border: 2px solid rgba(251, 191, 36, 0.3);
        position: relative;
        overflow: hidden;
    }

    .fortune-input-title {
        text-align: center;
        font-size: 2.5rem;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 16px;
        font-weight: 900;
    }

    .fortune-input-subtitle {
        text-align: center;
        color: #cbd5e1;
        font-size: 1.1rem;
        margin-bottom: 48px;
    }

    .birth-year-input-group {
        margin-bottom: 40px;
    }

    .birth-year-label {
        display: block;
        color: #fbbf24;
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 12px;
        text-align: center;
    }

    .birth-year-input {
        width: 100%;
        padding: 20px;
        font-size: 1.5rem;
        text-align: center;
        border: 2px solid rgba(251, 191, 36, 0.3);
        border-radius: 16px;
        background: rgba(15, 23, 42, 0.5);
        color: #fbbf24;
        font-weight: 700;
        outline: none;
        transition: all 0.3s ease;
    }

    .birth-year-input:focus {
        border-color: #fbbf24;
        box-shadow: 0 0 24px rgba(251, 191, 36, 0.3);
    }

    .birth-year-input::placeholder {
        color: rgba(203, 213, 225, 0.5);
    }

    .zodiac-preview {
        text-align: center;
        margin: 32px 0;
        padding: 24px;
        background: rgba(251, 191, 36, 0.1);
        border-radius: 20px;
        border: 1px solid rgba(251, 191, 36, 0.2);
        min-height: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .zodiac-preview-icon {
        font-size: 4rem;
        margin-bottom: 12px;
    }

    .zodiac-preview-text {
        color: #fbbf24;
        font-size: 1.5rem;
        font-weight: 700;
    }

    .zodiac-preview-empty {
        color: #64748b;
        font-size: 1rem;
    }

    .submit-button {
        width: 100%;
        padding: 20px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1e1b4b;
        border: none;
        border-radius: 50px;
        font-size: 1.3rem;
        font-weight: 800;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4);
    }

    .submit-button:hover:not(:disabled) {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(251, 191, 36, 0.6);
    }

    .submit-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* ê²°ê³¼ í™”ë©´ */
    .fortune-result-container {
        max-width: 800px;
        margin: 40px auto;
        padding: 0 20px;
        display: none;
    }

    .fortune-result-card {
        background: linear-gradient(135deg, rgba(30, 27, 75, 0.9), rgba(49, 46, 129, 0.9));
        border-radius: 32px;
        padding: 48px;
        border: 2px solid rgba(251, 191, 36, 0.3);
        box-shadow: 0 20px 60px rgba(30, 27, 75, 0.4);
    }

    .result-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 24px;
        border-bottom: 2px solid rgba(251, 191, 36, 0.2);
    }

    .result-zodiac-icon {
        font-size: 5rem;
        margin-bottom: 16px;
    }

    .result-zodiac-name {
        font-size: 2rem;
        color: #fbbf24;
        font-weight: 800;
        margin-bottom: 8px;
    }

    .result-date {
        color: #cbd5e1;
        font-size: 1.1rem;
    }

    .result-overall-score {
        text-align: center;
        margin: 40px 0;
        padding: 32px;
        background: rgba(251, 191, 36, 0.1);
        border-radius: 20px;
        border: 2px solid rgba(251, 191, 36, 0.3);
    }

    .result-overall-score-label {
        color: #cbd5e1;
        font-size: 1rem;
        margin-bottom: 12px;
    }

    .result-overall-score-value {
        font-size: 4rem;
        color: #fbbf24;
        font-weight: 900;
        margin-bottom: 8px;
    }

    .result-overall-score-stars {
        font-size: 2rem;
        color: #fbbf24;
    }

    .result-scores-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin: 32px 0;
    }

    .result-score-item {
        text-align: center;
        padding: 24px;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 16px;
        border: 1px solid rgba(251, 191, 36, 0.2);
    }

    .result-score-label {
        color: #cbd5e1;
        font-size: 0.95rem;
        margin-bottom: 12px;
    }

    .result-score-value {
        font-size: 2rem;
        color: #fbbf24;
        font-weight: 800;
        margin-bottom: 4px;
    }

    .result-score-stars {
        color: #fbbf24;
        font-size: 1.2rem;
    }

    .result-lucky-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 32px 0;
    }

    .result-lucky-item {
        padding: 24px;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 16px;
        border: 1px solid rgba(251, 191, 36, 0.2);
        text-align: center;
    }

    .result-lucky-label {
        color: #cbd5e1;
        font-size: 0.95rem;
        margin-bottom: 12px;
    }

    .result-lucky-value {
        font-size: 2rem;
        color: #fbbf24;
        font-weight: 800;
    }

    .result-lucky-color-box {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        margin: 12px auto 8px auto;
        border: 2px solid rgba(251, 191, 36, 0.3);
    }

    .result-messages {
        margin: 32px 0;
    }

    .result-message-box {
        padding: 24px;
        background: rgba(251, 191, 36, 0.1);
        border-radius: 16px;
        border-left: 4px solid #fbbf24;
        margin-bottom: 16px;
    }

    .result-message-title {
        color: #fbbf24;
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 12px;
    }

    .result-message-text {
        color: #e2e8f0;
        font-size: 1.05rem;
        line-height: 1.8;
    }

    .result-actions {
        margin-top: 40px;
        text-align: center;
    }

    .btn-retry {
        padding: 16px 40px;
        background: transparent;
        color: #fbbf24;
        border: 2px solid #fbbf24;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .btn-retry:hover {
        background: rgba(251, 191, 36, 0.1);
        transform: translateY(-2px);
    }

    /* ê³µìœ  ì„¹ì…˜ */
    .share-section {
        margin-top: 40px;
        padding: 32px;
        background: rgba(251, 191, 36, 0.1);
        border-radius: 20px;
        border: 2px solid rgba(251, 191, 36, 0.3);
        text-align: center;
    }

    .share-section h4 {
        font-size: 1.3rem;
        color: #fbbf24;
        margin-bottom: 20px;
        font-weight: 700;
    }

    .share-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-share {
        padding: 14px 28px;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-share:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-facebook {
        background: #1877f2;
        color: white;
    }

    .btn-copy {
        background: rgba(251, 191, 36, 0.2);
        color: #fbbf24;
        border: 2px solid #fbbf24;
    }

    .btn-share span {
        font-size: 1.2em;
    }

    @media (max-width: 768px) {
        .fortune-input-container,
        .fortune-result-card {
            padding: 32px 24px;
            margin: 20px;
        }

        .fortune-input-title {
            font-size: 2rem;
        }

        .result-scores-grid {
            grid-template-columns: 1fr;
        }

        .result-lucky-section {
            grid-template-columns: 1fr;
        }
    }
</style>
{{ end }}

{{ define "main" }}
<div class="fortune-page">
    <!-- ì…ë ¥ í™”ë©´ -->
    <div id="inputSection" class="fortune-input-container">
        <h2 class="fortune-input-title">ğŸ­ ë ë³„ ìš´ì„¸</h2>
        <p class="fortune-input-subtitle">ìƒë…„ì„ ì…ë ¥í•˜ë©´ ì„ íƒí•œ ì‹œê°„ëŒ€ì˜ ìš´ì„¸ë¥¼ ì•Œë ¤ë“œë ¤ìš”</p>

        <!-- ì‹œê°„ëŒ€ ì„ íƒ íƒ­ -->
        <div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 40px; flex-wrap: wrap;">
            <button class="period-tab active" data-period="today" style="padding: 12px 28px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1e1b4b; border: none; border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);">
                ì˜¤ëŠ˜
            </button>
            <button class="period-tab" data-period="week" style="padding: 12px 28px; background: rgba(251, 191, 36, 0.1); color: #fbbf24; border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                ì´ë²ˆì£¼
            </button>
            <button class="period-tab" data-period="month" style="padding: 12px 28px; background: rgba(251, 191, 36, 0.1); color: #fbbf24; border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                ì´ë²ˆë‹¬
            </button>
            <button class="period-tab" data-period="year" style="padding: 12px 28px; background: rgba(251, 191, 36, 0.1); color: #fbbf24; border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                ì˜¬í•´
            </button>
        </div>

        <div class="birth-year-input-group">
            <label class="birth-year-label">íƒœì–´ë‚œ ì—°ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš”</label>
            <input
                type="number"
                id="birthYearInput"
                class="birth-year-input"
                placeholder="ì˜ˆ: 1991"
                min="1900"
                max="2025"
                inputmode="numeric"
            >
        </div>

        <div id="zodiacPreview" class="zodiac-preview">
            <p class="zodiac-preview-empty">ìƒë…„ì„ ì…ë ¥í•˜ë©´ ë ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>
        </div>

        <button id="submitButton" class="submit-button" disabled>
            ìš´ì„¸ í™•ì¸í•˜ê¸°
        </button>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div id="resultSection" class="fortune-result-container">
        <div class="fortune-result-card">
            <div class="result-header">
                <div id="resultIcon" class="result-zodiac-icon"></div>
                <h3 id="resultName" class="result-zodiac-name"></h3>
                <p id="resultDate" class="result-date"></p>
            </div>

            <!-- ê²°ê³¼ í™”ë©´ ì‹œê°„ëŒ€ ì„ íƒ íƒ­ -->
            <div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 32px; flex-wrap: wrap;">
                <button class="result-period-tab active" data-period="today" style="padding: 12px 28px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1e1b4b; border: none; border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);">
                    ì˜¤ëŠ˜
                </button>
                <button class="result-period-tab" data-period="week" style="padding: 12px 28px; background: rgba(251, 191, 36, 0.1); color: #fbbf24; border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                    ì´ë²ˆì£¼
                </button>
                <button class="result-period-tab" data-period="month" style="padding: 12px 28px; background: rgba(251, 191, 36, 0.1); color: #fbbf24; border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                    ì´ë²ˆë‹¬
                </button>
                <button class="result-period-tab" data-period="year" style="padding: 12px 28px; background: rgba(251, 191, 36, 0.1); color: #fbbf24; border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                    ì˜¬í•´
                </button>
            </div>

            <div class="result-overall-score">
                <div id="resultPeriodTitle" class="result-overall-score-label">ì¢…í•© ìš´ì„¸</div>
                <div id="resultTotalScore" class="result-overall-score-value"></div>
                <div id="resultTotalStars" class="result-overall-score-stars"></div>
            </div>

            <!-- ì„¸ë¶€ ìš´ì„¸ ì•„ì½”ë””ì–¸ -->
            <div class="accordion-section" style="margin-bottom: 24px;">
                <button class="accordion-header" onclick="toggleAccordion('detailFortune')" style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2)); border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸ’« ì„¸ë¶€ ìš´ì„¸ ë³´ê¸°</span>
                    <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                </button>
                <div id="detailFortune" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease;">
                    <div class="accordion-inner" style="padding-top: 20px;">
                        <div class="result-scores-grid">
                            <div class="result-score-item">
                                <div class="result-score-label">ğŸ’• ì• ì •ìš´</div>
                                <div id="resultLoveScore" class="result-score-value"></div>
                                <div id="resultLoveStars" class="result-score-stars"></div>
                            </div>
                            <div class="result-score-item">
                                <div class="result-score-label">ğŸ’° ê¸ˆì „ìš´</div>
                                <div id="resultMoneyScore" class="result-score-value"></div>
                                <div id="resultMoneyStars" class="result-score-stars"></div>
                            </div>
                            <div class="result-score-item">
                                <div class="result-score-label">ğŸ’¼ ì§ì¥ìš´</div>
                                <div id="resultWorkScore" class="result-score-value"></div>
                                <div id="resultWorkStars" class="result-score-stars"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í–‰ìš´ ì•„ì´í…œ ì•„ì½”ë””ì–¸ -->
            <div class="accordion-section" style="margin-bottom: 24px;">
                <button class="accordion-header" onclick="toggleAccordion('luckyItems')" style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2)); border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸ€ í–‰ìš´ì˜ ì•„ì´í…œ ë³´ê¸°</span>
                    <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                </button>
                <div id="luckyItems" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease;">
                    <div class="accordion-inner" style="padding-top: 20px;">
                        <div class="result-lucky-section">
                            <div class="result-lucky-item">
                                <div class="result-lucky-label">ğŸ¨ ëŸ­í‚¤ ì»¬ëŸ¬</div>
                                <div id="resultLuckyColorBox" class="result-lucky-color-box"></div>
                                <div id="resultLuckyColor" class="result-lucky-value"></div>
                            </div>
                            <div class="result-lucky-item">
                                <div class="result-lucky-label">ğŸ”¢ ëŸ­í‚¤ ë„˜ë²„</div>
                                <div id="resultLuckyNumber" class="result-lucky-value"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìƒì„¸ ë©”ì‹œì§€ ì•„ì½”ë””ì–¸ -->
            <div class="accordion-section" style="margin-bottom: 24px;">
                <button class="accordion-header" onclick="toggleAccordion('fortuneMessages')" style="width: 100%; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2)); border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.3)';" onmouseout="this.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2))'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                    <span style="font-size: 1.2rem; color: #fbbf24; font-weight: 700;">ğŸ“ ìƒì„¸ ë©”ì‹œì§€ ë³´ê¸°</span>
                    <span class="accordion-icon" style="font-size: 1.5rem; color: #fbbf24; transition: transform 0.3s ease;">â–¼</span>
                </button>
                <div id="fortuneMessages" class="accordion-content" style="overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease;">
                    <div class="accordion-inner" style="padding-top: 20px;">
                        <div class="result-messages">
                            <div class="result-message-box">
                                <div class="result-message-title">ğŸ“‹ ì˜¤ëŠ˜ì˜ ìš´ì„¸</div>
                                <p id="resultOverallMessage" class="result-message-text"></p>
                            </div>
                            <div class="result-message-box">
                                <div class="result-message-title">âœ¨ íŠ¹ë³„ ë©”ì‹œì§€</div>
                                <p id="resultSpecialMessage" class="result-message-text"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³µìœ  ì„¹ì…˜ -->
            <div class="share-section">
                <h4>ğŸ’¬ ê²°ê³¼ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°</h4>
                <div class="share-buttons">
                    <button class="btn-share btn-download" onclick="downloadChineseZodiacImage()" style="background: linear-gradient(135deg, #f093fb, #f5576c); box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);">
                        <span>ğŸ“¸</span> <span class="download-text">ì´ë¯¸ì§€ ì €ì¥</span>
                    </button>
                    <button class="btn-share btn-facebook" onclick="shareFacebook()">
                        <span>ğŸ“˜</span> í˜ì´ìŠ¤ë¶
                    </button>
                    <button class="btn-share btn-copy" id="copyBtn" onclick="copyLink()">
                        <span>ğŸ”—</span> ë§í¬ ë³µì‚¬
                    </button>
                </div>
            </div>

            <div class="result-actions">
                <button class="btn-retry" onclick="resetFortune()">ë‹¤ì‹œ í•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>

<script src="/js/fortune-engine.js?v=20260102"></script>
<script>
    const birthYearInput = document.getElementById('birthYearInput');
    const zodiacPreview = document.getElementById('zodiacPreview');
    const submitButton = document.getElementById('submitButton');
    const inputSection = document.getElementById('inputSection');
    const resultSection = document.getElementById('resultSection');

    // ì„ íƒëœ ì‹œê°„ëŒ€ ë° ì €ì¥ëœ ìƒë…„
    let selectedPeriod = 'today';
    let savedYear = null;

    // ì‹œê°„ëŒ€ íƒ­ ì „í™˜ (ì…ë ¥ í™”ë©´)
    document.querySelectorAll('.period-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼
            document.querySelectorAll('.period-tab').forEach(t => {
                t.style.background = 'rgba(251, 191, 36, 0.1)';
                t.style.color = '#fbbf24';
                t.style.border = '2px solid rgba(251, 191, 36, 0.3)';
                t.style.boxShadow = 'none';
                t.classList.remove('active');
            });

            // í˜„ì¬ íƒ­ í™œì„±í™”
            this.style.background = 'linear-gradient(135deg, #fbbf24, #f59e0b)';
            this.style.color = '#1e1b4b';
            this.style.border = 'none';
            this.style.boxShadow = '0 4px 12px rgba(251, 191, 36, 0.3)';
            this.classList.add('active');

            selectedPeriod = this.dataset.period;
        });
    });

    // ì‹œê°„ëŒ€ íƒ­ ì „í™˜ (ê²°ê³¼ í™”ë©´) - ì¦‰ì‹œ ì—…ë°ì´íŠ¸
    function initResultPeriodTabs() {
        document.querySelectorAll('.result-period-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // ëª¨ë“  íƒ­ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼
                document.querySelectorAll('.result-period-tab').forEach(t => {
                    t.style.background = 'rgba(251, 191, 36, 0.1)';
                    t.style.color = '#fbbf24';
                    t.style.border = '2px solid rgba(251, 191, 36, 0.3)';
                    t.style.boxShadow = 'none';
                    t.classList.remove('active');
                });

                // í˜„ì¬ íƒ­ í™œì„±í™”
                this.style.background = 'linear-gradient(135deg, #fbbf24, #f59e0b)';
                this.style.color = '#1e1b4b';
                this.style.border = 'none';
                this.style.boxShadow = '0 4px 12px rgba(251, 191, 36, 0.3)';
                this.classList.add('active');

                selectedPeriod = this.dataset.period;

                // ì €ì¥ëœ ìƒë…„ìœ¼ë¡œ ìš´ì„¸ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                if (savedYear) {
                    updateFortuneResult(savedYear, selectedPeriod);
                }
            });
        });
    }

    // ì…ë ¥ ê°ì§€
    birthYearInput.addEventListener('input', function() {
        const year = parseInt(this.value);

        if (year && year >= 1900 && year <= 2025) {
            // ë  ê³„ì‚°
            const zodiacKey = getZodiacByYear(year);
            const zodiac = CHINESE_ZODIAC[zodiacKey];

            // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            zodiacPreview.innerHTML = `
                <div class="zodiac-preview-icon">${zodiac.icon}</div>
                <div class="zodiac-preview-text">${zodiac.name}</div>
            `;

            submitButton.disabled = false;
        } else {
            zodiacPreview.innerHTML = '<p class="zodiac-preview-empty">ìƒë…„ì„ ì…ë ¥í•˜ë©´ ë ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>';
            submitButton.disabled = true;
        }
    });

    // ì—”í„°í‚¤ë¡œ ì œì¶œ
    birthYearInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !submitButton.disabled) {
            showFortune();
        }
    });

    // ìš´ì„¸ ë³´ê¸°
    submitButton.addEventListener('click', showFortune);

    // ìš´ì„¸ ê²°ê³¼ ë Œë”ë§ (ê³µí†µ í•¨ìˆ˜)
    function renderFortuneResult(fortune, period) {
        // ì‹œê°„ëŒ€ë³„ ì œëª©
        const periodTitles = {
            today: 'ì˜¤ëŠ˜ì˜ ì¢…í•© ìš´ì„¸',
            week: 'ì´ë²ˆì£¼ ì¢…í•© ìš´ì„¸',
            month: 'ì´ë²ˆë‹¬ ì¢…í•© ìš´ì„¸',
            year: 'ì˜¬í•´ ì¢…í•© ìš´ì„¸'
        };
        document.getElementById('resultPeriodTitle').textContent = periodTitles[period];

        // ê²°ê³¼ í‘œì‹œ
        document.getElementById('resultIcon').textContent = fortune.zodiac.icon;
        document.getElementById('resultName').textContent = fortune.zodiac.name;
        document.getElementById('resultDate').textContent = `${fortune.periodLabel}ì˜ ìš´ì„¸`;

        document.getElementById('resultTotalScore').textContent = fortune.scores.total + 'ì ';
        document.getElementById('resultTotalStars').textContent = getStars(fortune.scores.total);

        document.getElementById('resultLoveScore').textContent = fortune.scores.love + 'ì ';
        document.getElementById('resultLoveStars').textContent = getStars(fortune.scores.love);

        document.getElementById('resultMoneyScore').textContent = fortune.scores.money + 'ì ';
        document.getElementById('resultMoneyStars').textContent = getStars(fortune.scores.money);

        document.getElementById('resultWorkScore').textContent = fortune.scores.work + 'ì ';
        document.getElementById('resultWorkStars').textContent = getStars(fortune.scores.work);

        document.getElementById('resultLuckyColorBox').style.backgroundColor = fortune.luckyColor.hex;
        document.getElementById('resultLuckyColor').textContent = fortune.luckyColor.name;

        document.getElementById('resultLuckyNumber').textContent = fortune.luckyNumber;

        document.getElementById('resultOverallMessage').textContent = fortune.messages.overall;
        document.getElementById('resultSpecialMessage').textContent = fortune.messages.special;

        // ê²°ê³¼ í™”ë©´ íƒ­ì˜ active ìƒíƒœ ì—…ë°ì´íŠ¸
        document.querySelectorAll('.result-period-tab').forEach(tab => {
            if (tab.dataset.period === period) {
                tab.style.background = 'linear-gradient(135deg, #fbbf24, #f59e0b)';
                tab.style.color = '#1e1b4b';
                tab.style.border = 'none';
                tab.style.boxShadow = '0 4px 12px rgba(251, 191, 36, 0.3)';
                tab.classList.add('active');
            } else {
                tab.style.background = 'rgba(251, 191, 36, 0.1)';
                tab.style.color = '#fbbf24';
                tab.style.border = '2px solid rgba(251, 191, 36, 0.3)';
                tab.style.boxShadow = 'none';
                tab.classList.remove('active');
            }
        });
    }

    // ì²˜ìŒ ìš´ì„¸ í™•ì¸ (í™”ë©´ ì „í™˜)
    function showFortune() {
        const year = parseInt(birthYearInput.value);
        if (!year) return;

        // ìƒë…„ ì €ì¥
        savedYear = year;

        // ìš´ì„¸ ê³„ì‚°
        const fortune = getChineseZodiacFortune(year, selectedPeriod);

        renderFortuneResult(fortune, selectedPeriod);

        // í™”ë©´ ì „í™˜
        inputSection.style.display = 'none';
        resultSection.style.display = 'block';

        // ìŠ¤í¬ë¡¤ to top
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // ê²°ê³¼ í™”ë©´ íƒ­ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
        initResultPeriodTabs();
    }

    // ê²°ê³¼ í™”ë©´ì—ì„œ ì‹œê°„ëŒ€ë§Œ ë³€ê²½ (ìŠ¤í¬ë¡¤ ìœ ì§€)
    function updateFortuneResult(year, period) {
        const fortune = getChineseZodiacFortune(year, period);
        renderFortuneResult(fortune, period);
        // ìŠ¤í¬ë¡¤ì€ ìœ ì§€ë¨ (í™”ë©´ ì „í™˜ ì—†ìŒ)
    }

    function resetFortune() {
        inputSection.style.display = 'block';
        resultSection.style.display = 'none';
        birthYearInput.value = '';
        zodiacPreview.innerHTML = '<p class="zodiac-preview-empty">ìƒë…„ì„ ì…ë ¥í•˜ë©´ ë ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>';
        submitButton.disabled = true;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // í˜ì´ìŠ¤ë¶ ê³µìœ 
    function shareFacebook() {
        const url = encodeURIComponent(window.location.href);
        const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
        window.open(shareUrl, '_blank', 'width=600,height=400');
    }

    // ë§í¬ ë³µì‚¬
    function copyLink() {
        const url = window.location.href;
        const copyBtn = document.getElementById('copyBtn');

        // Clipboard API ì‚¬ìš© (ëª¨ë˜ ë¸Œë¼ìš°ì €)
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(() => {
                copyBtn.innerHTML = '<span>âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<span>ğŸ”—</span> ë§í¬ ë³µì‚¬';
                }, 2000);
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                fallbackCopyLink(url, copyBtn);
            });
        } else {
            // í´ë°±: execCommand ì‚¬ìš© (êµ¬í˜• ë¸Œë¼ìš°ì €)
            fallbackCopyLink(url, copyBtn);
        }
    }

    // í´ë°± ë³µì‚¬ í•¨ìˆ˜
    function fallbackCopyLink(text, btn) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();

        try {
            document.execCommand('copy');
            btn.innerHTML = '<span>âœ…</span> ë³µì‚¬ ì™„ë£Œ!';
            setTimeout(() => {
                btn.innerHTML = '<span>ğŸ”—</span> ë§í¬ ë³µì‚¬';
            }, 2000);
        } catch (err) {
            console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }

        document.body.removeChild(textArea);
    }

    // ì´ë¯¸ì§€ ì €ì¥ í•¨ìˆ˜
    async function downloadChineseZodiacImage() {
        const downloadBtn = document.querySelector('.download-text');
        if (downloadBtn) {
            downloadBtn.textContent = 'ìƒì„± ì¤‘...';
        }

        try {
            // html2canvasê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof html2canvas === 'undefined') {
                throw new Error('html2canvasê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }

            const resultSection = document.getElementById('resultSection');
            if (!resultSection) {
                throw new Error('ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            // ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ê³¼ ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const shareSection = document.querySelector('.share-section');
            const resultActions = document.querySelector('.result-actions');
            const shareSectionDisplay = shareSection ? shareSection.style.display : '';
            const resultActionsDisplay = resultActions ? resultActions.style.display : '';

            if (shareSection) shareSection.style.display = 'none';
            if (resultActions) resultActions.style.display = 'none';

            // ë¸Œëœë“œ ì›Œí„°ë§ˆí¬ ì¶”ê°€
            const watermark = document.createElement('div');
            watermark.style.cssText = 'text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(251, 191, 36, 0.3); font-size: 14px; color: #fbbf24; font-weight: 600;';
            watermark.innerHTML = 'âœ¨ natest.krì—ì„œ ë” ë§ì€ ìš´ì„¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!';
            resultSection.appendChild(watermark);

            // html2canvasë¡œ ìº¡ì²˜
            const canvas = await html2canvas(resultSection, {
                backgroundColor: '#1e1b4b',
                scale: 2, // ê³ í•´ìƒë„
                logging: false,
                useCORS: true,
                allowTaint: true,
                width: resultSection.scrollWidth,
                height: resultSection.scrollHeight
            });

            // ì›Œí„°ë§ˆí¬ ì œê±°
            resultSection.removeChild(watermark);

            // ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ê³¼ ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ë³µì›
            if (shareSection) shareSection.style.display = shareSectionDisplay;
            if (resultActions) resultActions.style.display = resultActionsDisplay;

            // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
            canvas.toBlob((blob) => {
                if (!blob) {
                    throw new Error('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                // íŒŒì¼ëª… ìƒì„±
                const zodiacName = document.getElementById('resultName').textContent || 'ë ';
                const today = new Date();
                const dateStr = `${today.getMonth() + 1}ì›”${today.getDate()}ì¼`;
                const periodNames = {
                    today: 'ì˜¤ëŠ˜ì˜ìš´ì„¸',
                    week: 'ì´ë²ˆì£¼ìš´ì„¸',
                    month: 'ì´ë²ˆë‹¬ìš´ì„¸',
                    year: 'ì˜¬í•´ìš´ì„¸'
                };
                const fileName = `${zodiacName}_${periodNames[selectedPeriod]}_${dateStr}.png`;

                // ë‹¤ìš´ë¡œë“œ
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                if (downloadBtn) {
                    downloadBtn.textContent = 'ì €ì¥ ì™„ë£Œ!';
                    setTimeout(() => {
                        downloadBtn.textContent = 'ì´ë¯¸ì§€ ì €ì¥';
                    }, 2000);
                }
            }, 'image/png');

        } catch (error) {
            console.error('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
            alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');

            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³µì›
            if (downloadBtn) {
                downloadBtn.textContent = 'ì´ë¯¸ì§€ ì €ì¥';
            }
        }
    }

    // ì•„ì½”ë””ì–¸ ì‹œìŠ¤í…œ
    function toggleAccordion(id) {
        const content = document.getElementById(id);
        const button = content.previousElementSibling;
        const icon = button.querySelector('.accordion-icon');

        if (content.style.maxHeight && content.style.maxHeight !== '0px') {
            content.style.maxHeight = '0px';
            content.style.opacity = '0';
            icon.style.transform = 'rotate(0deg)';
        } else {
            content.style.maxHeight = (content.scrollHeight + 50) + 'px';
            content.style.opacity = '1';
            icon.style.transform = 'rotate(180deg)';
            setTimeout(() => {
                content.style.maxHeight = (content.scrollHeight + 50) + 'px';
            }, 100);
        }
    }

    function initializeAccordions() {
        const isMobile = window.innerWidth <= 768;
        const accordions = ['detailFortune', 'luckyItems', 'fortuneMessages'];

        accordions.forEach(id => {
            const content = document.getElementById(id);
            const button = content.previousElementSibling;
            const icon = button.querySelector('.accordion-icon');

            if (isMobile) {
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.style.maxHeight = (content.scrollHeight + 50) + 'px';
                content.style.opacity = '1';
                icon.style.transform = 'rotate(180deg)';
            }
        });
    }

    // ê²°ê³¼ í‘œì‹œ í›„ ì•„ì½”ë””ì–¸ ì´ˆê¸°í™”
    const originalDisplayResult = window.displayChineseZodiacResult;
    window.displayChineseZodiacResult = function() {
        if (originalDisplayResult) originalDisplayResult.apply(this, arguments);
        setTimeout(initializeAccordions, 100);
    };

    window.addEventListener('resize', () => {
        clearTimeout(window.resizeTimer);
        window.resizeTimer = setTimeout(() => {
            ['detailFortune', 'luckyItems', 'fortuneMessages'].forEach(id => {
                const content = document.getElementById(id);
                if (content.style.opacity === '1') {
                    content.style.maxHeight = (content.scrollHeight + 50) + 'px';
                }
            });
        }, 250);
    });
</script>
{{ end }}
